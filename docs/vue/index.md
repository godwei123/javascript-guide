# Vue é¢è¯•é¢˜

## MVVM

MVVM æ˜¯ Model-View-ViewModel ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯æŠŠ MVC ä¸­çš„ Controller æ¼”å˜æˆ ViewModelã€‚Model å±‚ä»£è¡¨æ•°æ®æ¨¡å‹ï¼ŒView ä»£è¡¨ UI ç»„ä»¶ï¼ŒViewModel æ˜¯ View å’Œ Model å±‚çš„æ¡¥æ¢ï¼Œæ•°æ®ä¼šç»‘å®šåˆ° viewModel å±‚å¹¶è‡ªåŠ¨å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­ï¼Œè§†å›¾å˜åŒ–çš„æ—¶å€™ä¼šé€šçŸ¥ viewModel å±‚æ›´æ–°æ•°æ®ã€‚

## Vue2.x å“åº”å¼æ•°æ®åŸç†

Vue åœ¨åˆå§‹åŒ–æ•°æ®æ—¶ï¼Œä¼šä½¿ç”¨ Object.defineProperty é‡æ–°å®šä¹‰ data ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œå½“é¡µé¢ä½¿ç”¨å¯¹åº”å±æ€§æ—¶ï¼Œé¦–å…ˆä¼šè¿›è¡Œä¾èµ–æ”¶é›†(æ”¶é›†å½“å‰ç»„ä»¶çš„ watcher)å¦‚æœå±æ€§å‘ç”Ÿå˜åŒ–ä¼šé€šçŸ¥ç›¸å…³ä¾èµ–è¿›è¡Œæ›´æ–°æ“ä½œ(å‘å¸ƒè®¢é˜…)ã€‚

## Vue3.x å“åº”å¼æ•°æ®åŸç†

Vue3.x æ”¹ç”¨ Proxy æ›¿ä»£ Object.definePropertyã€‚å› ä¸º Proxy å¯ä»¥ç›´æ¥ç›‘å¬å¯¹è±¡å’Œæ•°ç»„çš„å˜åŒ–ï¼Œå¹¶ä¸”æœ‰å¤šè¾¾ 13 ç§æ‹¦æˆªæ–¹æ³•ã€‚å¹¶ä¸”ä½œä¸ºæ–°æ ‡å‡†å°†å—åˆ°æµè§ˆå™¨å‚å•†é‡ç‚¹æŒç»­çš„æ€§èƒ½ä¼˜åŒ–ã€‚

Proxy åªä¼šä»£ç†å¯¹è±¡çš„ç¬¬ä¸€å±‚ï¼Œé‚£ä¹ˆ Vue3 åˆæ˜¯æ€æ ·å¤„ç†è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ

åˆ¤æ–­å½“å‰ Reflect.get çš„è¿”å›å€¼æ˜¯å¦ä¸º Objectï¼Œå¦‚æœæ˜¯åˆ™å†é€šè¿‡ reactive æ–¹æ³•åšä»£ç†ï¼Œ è¿™æ ·å°±å®ç°äº†æ·±åº¦è§‚æµ‹ã€‚

ç›‘æµ‹æ•°ç»„çš„æ—¶å€™å¯èƒ½è§¦å‘å¤šæ¬¡ get/setï¼Œé‚£ä¹ˆå¦‚ä½•é˜²æ­¢è§¦å‘å¤šæ¬¡å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥åˆ¤æ–­ key æ˜¯å¦ä¸ºå½“å‰è¢«ä»£ç†å¯¹è±¡ target è‡ªèº«å±æ€§ï¼Œä¹Ÿå¯ä»¥åˆ¤æ–­æ—§å€¼ä¸æ–°å€¼æ˜¯å¦ç›¸ç­‰ï¼Œåªæœ‰æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€æ—¶ï¼Œæ‰æœ‰å¯èƒ½æ‰§è¡Œ triggerã€‚

## vue2.x ä¸­å¦‚ä½•ç›‘æµ‹æ•°ç»„å˜åŒ–

ä½¿ç”¨äº†å‡½æ•°åŠ«æŒçš„æ–¹å¼ï¼Œé‡å†™äº†æ•°ç»„çš„æ–¹æ³•ï¼ŒVue å°† data ä¸­çš„æ•°ç»„è¿›è¡Œäº†åŸå‹é“¾é‡å†™ï¼ŒæŒ‡å‘äº†è‡ªå·±å®šä¹‰çš„æ•°ç»„åŸå‹æ–¹æ³•ã€‚è¿™æ ·å½“è°ƒç”¨æ•°ç»„ api æ—¶ï¼Œå¯ä»¥é€šçŸ¥ä¾èµ–æ›´æ–°ã€‚å¦‚æœæ•°ç»„ä¸­åŒ…å«ç€å¼•ç”¨ç±»å‹ï¼Œä¼šå¯¹æ•°ç»„ä¸­çš„å¼•ç”¨ç±»å‹å†æ¬¡é€’å½’éå†è¿›è¡Œç›‘æ§ã€‚è¿™æ ·å°±å®ç°äº†ç›‘æµ‹æ•°ç»„å˜åŒ–ã€‚

## nextTick çŸ¥é“å—ï¼Œå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ä¸‹æ¬¡ DOM æ›´æ–°å¾ªç¯ç»“æŸä¹‹åæ‰§è¡Œå»¶è¿Ÿå›è°ƒã€‚nextTick ä¸»è¦ä½¿ç”¨äº†å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ã€‚æ ¹æ®æ‰§è¡Œç¯å¢ƒåˆ†åˆ«å°è¯•é‡‡ç”¨ Promiseã€MutationObserverã€setImmediateï¼Œå¦‚æœä»¥ä¸Šéƒ½ä¸è¡Œåˆ™é‡‡ç”¨ setTimeout

å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå¤šæ¬¡è°ƒç”¨ nextTick ä¼šå°†æ–¹æ³•å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œé€šè¿‡è¿™ä¸ªå¼‚æ­¥æ–¹æ³•æ¸…ç©ºå½“å‰é˜Ÿåˆ—ã€‚

## Vue çš„ç”Ÿå‘½å‘¨æœŸ

beforeCreate æ˜¯ new Vue()ä¹‹åè§¦å‘çš„ç¬¬ä¸€ä¸ªé’©å­ï¼Œåœ¨å½“å‰é˜¶æ®µ dataã€methodsã€computed ä»¥åŠ watch ä¸Šçš„æ•°æ®å’Œæ–¹æ³•éƒ½ä¸èƒ½è¢«è®¿é—®ã€‚

created åœ¨å®ä¾‹åˆ›å»ºå®Œæˆåå‘ç”Ÿï¼Œå½“å‰é˜¶æ®µå·²ç»å®Œæˆäº†æ•°æ®è§‚æµ‹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä½¿ç”¨æ•°æ®ï¼Œæ›´æ”¹æ•°æ®ï¼Œåœ¨è¿™é‡Œæ›´æ”¹æ•°æ®ä¸ä¼šè§¦å‘ updated å‡½æ•°ã€‚å¯ä»¥åšä¸€äº›åˆå§‹æ•°æ®çš„è·å–ï¼Œåœ¨å½“å‰é˜¶æ®µæ— æ³•ä¸ Dom è¿›è¡Œäº¤äº’ï¼Œå¦‚æœéè¦æƒ³ï¼Œå¯ä»¥é€šè¿‡ vm.$nextTick æ¥è®¿é—® Domã€‚

beforeMount å‘ç”Ÿåœ¨æŒ‚è½½ä¹‹å‰ï¼Œåœ¨è¿™ä¹‹å‰ template æ¨¡æ¿å·²å¯¼å…¥æ¸²æŸ“å‡½æ•°ç¼–è¯‘ã€‚è€Œå½“å‰é˜¶æ®µè™šæ‹Ÿ Dom å·²ç»åˆ›å»ºå®Œæˆï¼Œå³å°†å¼€å§‹æ¸²æŸ“ã€‚åœ¨æ­¤æ—¶ä¹Ÿå¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ›´æ”¹ï¼Œä¸ä¼šè§¦å‘ updatedã€‚

mounted åœ¨æŒ‚è½½å®Œæˆåå‘ç”Ÿï¼Œåœ¨å½“å‰é˜¶æ®µï¼ŒçœŸå®çš„ Dom æŒ‚è½½å®Œæ¯•ï¼Œæ•°æ®å®ŒæˆåŒå‘ç»‘å®šï¼Œå¯ä»¥è®¿é—®åˆ° Dom èŠ‚ç‚¹ï¼Œä½¿ç”¨$refs å±æ€§å¯¹ Dom è¿›è¡Œæ“ä½œã€‚

beforeUpdate å‘ç”Ÿåœ¨æ›´æ–°ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯å“åº”å¼æ•°æ®å‘ç”Ÿæ›´æ–°ï¼Œè™šæ‹Ÿ dom é‡æ–°æ¸²æŸ“ä¹‹å‰è¢«è§¦å‘ï¼Œä½ å¯ä»¥åœ¨å½“å‰é˜¶æ®µè¿›è¡Œæ›´æ”¹æ•°æ®ï¼Œä¸ä¼šé€ æˆé‡æ¸²æŸ“ã€‚

updated å‘ç”Ÿåœ¨æ›´æ–°å®Œæˆä¹‹åï¼Œå½“å‰é˜¶æ®µç»„ä»¶ Dom å·²å®Œæˆæ›´æ–°ã€‚è¦æ³¨æ„çš„æ˜¯é¿å…åœ¨æ­¤æœŸé—´æ›´æ”¹æ•°æ®ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯çš„æ›´æ–°ã€‚

beforeDestroy å‘ç”Ÿåœ¨å®ä¾‹é”€æ¯ä¹‹å‰ï¼Œåœ¨å½“å‰é˜¶æ®µå®ä¾‹å®Œå…¨å¯ä»¥è¢«ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™æ—¶è¿›è¡Œå–„åæ”¶å°¾å·¥ä½œï¼Œæ¯”å¦‚æ¸…é™¤è®¡æ—¶å™¨ã€‚

destroyed å‘ç”Ÿåœ¨å®ä¾‹é”€æ¯ä¹‹åï¼Œè¿™ä¸ªæ—¶å€™åªå‰©ä¸‹äº† dom ç©ºå£³ã€‚ç»„ä»¶å·²è¢«æ‹†è§£ï¼Œæ•°æ®ç»‘å®šè¢«å¸é™¤ï¼Œç›‘å¬è¢«ç§»å‡ºï¼Œå­å®ä¾‹ä¹Ÿç»Ÿç»Ÿè¢«é”€æ¯ã€‚

## æ¥å£è¯·æ±‚ä¸€èˆ¬æ”¾åœ¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Ÿ

æ¥å£è¯·æ±‚ä¸€èˆ¬æ”¾åœ¨ mounted ä¸­ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯æœåŠ¡ç«¯æ¸²æŸ“æ—¶ä¸æ”¯æŒ mountedï¼Œéœ€è¦æ”¾åˆ° created ä¸­ã€‚

## Computed å’Œ Watch

Computed æœ¬è´¨æ˜¯ä¸€ä¸ªå…·å¤‡ç¼“å­˜çš„ watcherï¼Œä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–å°±ä¼šæ›´æ–°è§†å›¾ã€‚é€‚ç”¨äºè®¡ç®—æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½çš„è®¡ç®—åœºæ™¯ã€‚å½“è¡¨è¾¾å¼è¿‡äºå¤æ‚æ—¶ï¼Œåœ¨æ¨¡æ¿ä¸­æ”¾å…¥è¿‡å¤šé€»è¾‘ä¼šè®©æ¨¡æ¿éš¾ä»¥ç»´æŠ¤ï¼Œå¯ä»¥å°†å¤æ‚çš„é€»è¾‘æ”¾å…¥è®¡ç®—å±æ€§ä¸­å¤„ç†ã€‚

Watch æ²¡æœ‰ç¼“å­˜æ€§ï¼Œæ›´å¤šçš„æ˜¯è§‚å¯Ÿçš„ä½œç”¨ï¼Œå¯ä»¥ç›‘å¬æŸäº›æ•°æ®æ‰§è¡Œå›è°ƒã€‚å½“æˆ‘ä»¬éœ€è¦æ·±åº¦ç›‘å¬å¯¹è±¡ä¸­çš„å±æ€§æ—¶ï¼Œå¯ä»¥æ‰“å¼€ deepï¼štrue é€‰é¡¹ï¼Œè¿™æ ·ä¾¿ä¼šå¯¹å¯¹è±¡ä¸­çš„æ¯ä¸€é¡¹è¿›è¡Œç›‘å¬ã€‚è¿™æ ·ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œä¼˜åŒ–çš„è¯å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²å½¢å¼ç›‘å¬ï¼Œå¦‚æœæ²¡æœ‰å†™åˆ°ç»„ä»¶ä¸­ï¼Œä¸è¦å¿˜è®°ä½¿ç”¨ unWatch æ‰‹åŠ¨æ³¨é”€å“¦ã€‚

## v-if å’Œ v-show çš„åŒºåˆ«

å½“æ¡ä»¶ä¸æˆç«‹æ—¶ï¼Œv-if ä¸ä¼šæ¸²æŸ“ DOM å…ƒç´ ï¼Œ

v-show æ“ä½œçš„æ˜¯æ ·å¼(display)ï¼Œåˆ‡æ¢å½“å‰ DOM çš„æ˜¾ç¤ºå’Œéšè—ã€‚

## ç»„ä»¶ä¸­çš„ data ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Ÿ

ä¸€ä¸ªç»„ä»¶è¢«å¤ç”¨å¤šæ¬¡çš„è¯ï¼Œä¹Ÿå°±ä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚æœ¬è´¨ä¸Šï¼Œè¿™äº›å®ä¾‹ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªæ„é€ å‡½æ•°ã€‚å¦‚æœ data æ˜¯å¯¹è±¡çš„è¯ï¼Œå¯¹è±¡å±äºå¼•ç”¨ç±»å‹ï¼Œä¼šå½±å“åˆ°æ‰€æœ‰çš„å®ä¾‹ã€‚æ‰€ä»¥ä¸ºäº†ä¿è¯ç»„ä»¶ä¸åŒçš„å®ä¾‹ä¹‹é—´ data ä¸å†²çªï¼Œdata å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚

## v-model çš„åŸç†

v-model æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå¯ä»¥çœ‹æˆæ˜¯ value + input æ–¹æ³•çš„è¯­æ³•ç³–ã€‚å¯ä»¥é€šè¿‡ model å±æ€§çš„ prop å’Œ event å±æ€§æ¥è¿›è¡Œè‡ªå®šä¹‰ã€‚åŸç”Ÿçš„ v-modelï¼Œä¼šæ ¹æ®æ ‡ç­¾çš„ä¸åŒç”Ÿæˆä¸åŒçš„äº‹ä»¶å’Œå±æ€§ã€‚

## Vue äº‹ä»¶ç»‘å®šåŸç†

åŸç”Ÿäº‹ä»¶ç»‘å®šæ˜¯é€šè¿‡ addEventListener ç»‘å®šç»™çœŸå®å…ƒç´ çš„ï¼Œç»„ä»¶äº‹ä»¶ç»‘å®šæ˜¯é€šè¿‡ Vue è‡ªå®šä¹‰çš„$on å®ç°çš„ã€‚

## Vue æ¨¡ç‰ˆç¼–è¯‘åŸç†çŸ¥é“å—ï¼Œèƒ½ç®€å•è¯´ä¸€ä¸‹å—ï¼Ÿ

ç®€å•è¯´ï¼ŒVue çš„ç¼–è¯‘è¿‡ç¨‹å°±æ˜¯å°† template è½¬åŒ–ä¸º render å‡½æ•°çš„è¿‡ç¨‹ã€‚ä¼šç»å†ä»¥ä¸‹é˜¶æ®µï¼š

-   ç”Ÿæˆ AST æ ‘
-   ä¼˜åŒ–
-   codegen

é¦–å…ˆè§£ææ¨¡ç‰ˆï¼Œç”Ÿæˆ AST è¯­æ³•æ ‘(ä¸€ç§ç”¨ JavaScript å¯¹è±¡çš„å½¢å¼æ¥æè¿°æ•´ä¸ªæ¨¡æ¿)ã€‚ä½¿ç”¨å¤§é‡çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹æ¨¡æ¿è¿›è¡Œè§£æï¼Œé‡åˆ°æ ‡ç­¾ã€æ–‡æœ¬çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œå¯¹åº”çš„é’©å­è¿›è¡Œç›¸å…³å¤„ç†ã€‚

Vue çš„æ•°æ®æ˜¯å“åº”å¼çš„ï¼Œä½†å…¶å®æ¨¡æ¿ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å“åº”å¼çš„ã€‚æœ‰ä¸€äº›æ•°æ®é¦–æ¬¡æ¸²æŸ“åå°±ä¸ä¼šå†å˜åŒ–ï¼Œå¯¹åº”çš„ DOM ä¹Ÿä¸ä¼šå˜åŒ–ã€‚é‚£ä¹ˆä¼˜åŒ–è¿‡ç¨‹å°±æ˜¯æ·±åº¦éå† AST æ ‘ï¼ŒæŒ‰ç…§ç›¸å…³æ¡ä»¶å¯¹æ ‘èŠ‚ç‚¹è¿›è¡Œæ ‡è®°ã€‚è¿™äº›è¢«æ ‡è®°çš„èŠ‚ç‚¹(é™æ€èŠ‚ç‚¹)æˆ‘ä»¬å°±å¯ä»¥è·³è¿‡å¯¹å®ƒä»¬çš„æ¯”å¯¹ï¼Œå¯¹è¿è¡Œæ—¶çš„æ¨¡æ¿èµ·åˆ°å¾ˆå¤§çš„ä¼˜åŒ–ä½œç”¨ã€‚

ç¼–è¯‘çš„æœ€åä¸€æ­¥æ˜¯å°†ä¼˜åŒ–åçš„ AST æ ‘è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ä»£ç ã€‚

## Vue2.x å’Œ Vue3.x æ¸²æŸ“å™¨çš„ diff ç®—æ³•åˆ†åˆ«è¯´ä¸€ä¸‹

ç®€å•æ¥è¯´ï¼Œdiff ç®—æ³•æœ‰ä»¥ä¸‹è¿‡ç¨‹

-   åŒçº§æ¯”è¾ƒï¼Œå†æ¯”è¾ƒå­èŠ‚ç‚¹
-   å…ˆåˆ¤æ–­ä¸€æ–¹æœ‰å­èŠ‚ç‚¹ä¸€æ–¹æ²¡æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µ(å¦‚æœæ–°çš„ children æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå°†æ—§çš„å­èŠ‚ç‚¹ç§»é™¤)
-   æ¯”è¾ƒéƒ½æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µ(æ ¸å¿ƒ diff)
-   é€’å½’æ¯”è¾ƒå­èŠ‚ç‚¹

æ­£å¸¸ Diff ä¸¤ä¸ªæ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n^3)ï¼Œä½†å®é™…æƒ…å†µä¸‹æˆ‘ä»¬å¾ˆå°‘ä¼šè¿›è¡Œè·¨å±‚çº§çš„ç§»åŠ¨ DOMï¼Œæ‰€ä»¥ Vue å°† Diff è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä» O(n^3) -> O(n)ï¼Œåªæœ‰å½“æ–°æ—§ children éƒ½ä¸ºå¤šä¸ªå­èŠ‚ç‚¹æ—¶æ‰éœ€è¦ç”¨æ ¸å¿ƒçš„ Diff ç®—æ³•è¿›è¡ŒåŒå±‚çº§æ¯”è¾ƒã€‚

Vue2 çš„æ ¸å¿ƒ Diff ç®—æ³•é‡‡ç”¨äº†åŒç«¯æ¯”è¾ƒçš„ç®—æ³•ï¼ŒåŒæ—¶ä»æ–°æ—§ children çš„ä¸¤ç«¯å¼€å§‹è¿›è¡Œæ¯”è¾ƒï¼Œå€ŸåŠ© key å€¼æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œå†è¿›è¡Œç›¸å…³æ“ä½œã€‚ç›¸æ¯” React çš„ Diff ç®—æ³•ï¼ŒåŒæ ·æƒ…å†µä¸‹å¯ä»¥å‡å°‘ç§»åŠ¨èŠ‚ç‚¹æ¬¡æ•°ï¼Œå‡å°‘ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ï¼Œæ›´åŠ çš„ä¼˜é›…ã€‚

Vue3.x å€Ÿé‰´äº† ivi ç®—æ³•å’Œ inferno ç®—æ³•

åœ¨åˆ›å»º VNode æ—¶å°±ç¡®å®šå…¶ç±»å‹ï¼Œä»¥åŠåœ¨ mount/patch çš„è¿‡ç¨‹ä¸­é‡‡ç”¨ä½è¿ç®—æ¥åˆ¤æ–­ä¸€ä¸ª VNode çš„ç±»å‹ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šå†é…åˆæ ¸å¿ƒçš„ Diff ç®—æ³•ï¼Œä½¿å¾—æ€§èƒ½ä¸Šè¾ƒ Vue2.x æœ‰äº†æå‡ã€‚(å®é™…çš„å®ç°å¯ä»¥ç»“åˆ Vue3.x æºç çœ‹ã€‚)

è¯¥ç®—æ³•ä¸­è¿˜è¿ç”¨äº†åŠ¨æ€è§„åˆ’çš„æ€æƒ³æ±‚è§£æœ€é•¿é€’å½’å­åºåˆ—ã€‚

## è™šæ‹Ÿ Dom ä»¥åŠ key å±æ€§çš„ä½œç”¨

ç”±äºåœ¨æµè§ˆå™¨ä¸­æ“ä½œ DOM æ˜¯å¾ˆæ˜‚è´µçš„ã€‚é¢‘ç¹çš„æ“ä½œ DOMï¼Œä¼šäº§ç”Ÿä¸€å®šçš„æ€§èƒ½é—®é¢˜ã€‚è¿™å°±æ˜¯è™šæ‹Ÿ Dom çš„äº§ç”ŸåŸå› ã€‚

Vue2 çš„ Virtual DOM å€Ÿé‰´äº†å¼€æºåº“ snabbdom çš„å®ç°ã€‚

Virtual DOM æœ¬è´¨å°±æ˜¯ç”¨ä¸€ä¸ªåŸç”Ÿçš„ JS å¯¹è±¡å»æè¿°ä¸€ä¸ª DOM èŠ‚ç‚¹ã€‚æ˜¯å¯¹çœŸå® DOM çš„ä¸€å±‚æŠ½è±¡ã€‚(ä¹Ÿå°±æ˜¯æºç ä¸­çš„ VNode ç±»ï¼Œå®ƒå®šä¹‰åœ¨ src/core/vdom/vnode.js ä¸­ã€‚)

VirtualDOM æ˜ å°„åˆ°çœŸå® DOM è¦ç»å† VNode çš„ createã€diffã€patch ç­‰é˜¶æ®µã€‚

ã€Œkey çš„ä½œç”¨æ˜¯å°½å¯èƒ½çš„å¤ç”¨ DOM å…ƒç´ ã€‚ã€

æ–°æ—§ children ä¸­çš„èŠ‚ç‚¹åªæœ‰é¡ºåºæ˜¯ä¸åŒçš„æ—¶å€™ï¼Œæœ€ä½³çš„æ“ä½œåº”è¯¥æ˜¯é€šè¿‡ç§»åŠ¨å…ƒç´ çš„ä½ç½®æ¥è¾¾åˆ°æ›´æ–°çš„ç›®çš„ã€‚

éœ€è¦åœ¨æ–°æ—§ children çš„èŠ‚ç‚¹ä¸­ä¿å­˜æ˜ å°„å…³ç³»ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨æ—§ children çš„èŠ‚ç‚¹ä¸­æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ã€‚key ä¹Ÿå°±æ˜¯ children ä¸­èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ã€‚

## keep-alive äº†è§£å—

keep-alive å¯ä»¥å®ç°ç»„ä»¶ç¼“å­˜ï¼Œå½“ç»„ä»¶åˆ‡æ¢æ—¶ä¸ä¼šå¯¹å½“å‰ç»„ä»¶è¿›è¡Œå¸è½½ã€‚

å¸¸ç”¨çš„ä¸¤ä¸ªå±æ€§ include/excludeï¼Œå…è®¸ç»„ä»¶æœ‰æ¡ä»¶çš„è¿›è¡Œç¼“å­˜ã€‚

ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸ activated/deactivatedï¼Œç”¨æ¥å¾—çŸ¥å½“å‰ç»„ä»¶æ˜¯å¦å¤„äºæ´»è·ƒçŠ¶æ€ã€‚

keep-alive çš„ä¸­è¿˜è¿ç”¨äº† LRU(Least Recently Used)ç®—æ³•ã€‚

## Vue ä¸­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸè°ƒç”¨é¡ºåºè¯´ä¸€ä¸‹

ç»„ä»¶çš„è°ƒç”¨é¡ºåºéƒ½æ˜¯å…ˆçˆ¶åå­,æ¸²æŸ“å®Œæˆçš„é¡ºåºæ˜¯å…ˆå­åçˆ¶ã€‚

ç»„ä»¶çš„é”€æ¯æ“ä½œæ˜¯å…ˆçˆ¶åå­ï¼Œé”€æ¯å®Œæˆçš„é¡ºåºæ˜¯å…ˆå­åçˆ¶ã€‚

åŠ è½½æ¸²æŸ“è¿‡ç¨‹

çˆ¶ beforeCreate->çˆ¶ created->çˆ¶ beforeMount->å­ beforeCreate->å­ created->å­ beforeMount- >å­ mounted->çˆ¶ mounted

å­ç»„ä»¶æ›´æ–°è¿‡ç¨‹

çˆ¶ beforeUpdate->å­ beforeUpdate->å­ updated->çˆ¶ updated

é”€æ¯è¿‡ç¨‹

çˆ¶ beforeDestroy->å­ beforeDestroy->å­ destroyed->çˆ¶ destroyed

## Vue2.x ç»„ä»¶é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ

çˆ¶å­ç»„ä»¶é€šä¿¡

-   çˆ¶->å­ propsï¼Œå­->çˆ¶ $onã€$emit
-   è·å–çˆ¶å­ç»„ä»¶å®ä¾‹ $parentã€$children
-   Ref è·å–å®ä¾‹çš„æ–¹å¼è°ƒç”¨ç»„ä»¶çš„å±æ€§æˆ–è€…æ–¹æ³•
-   Provideã€inject å®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œä½†æ˜¯å†™ç»„ä»¶åº“æ—¶å¾ˆå¸¸ç”¨

å…„å¼Ÿç»„ä»¶é€šä¿¡

-   Event Bus å®ç°è·¨ç»„ä»¶é€šä¿¡ Vue.prototype.$bus = new Vue
-   Vuex

è·¨çº§ç»„ä»¶é€šä¿¡

-   Vuex
-   $attrsã€$listeners
-   Provideã€inject

## Vue çš„æ€§èƒ½ä¼˜åŒ–ï¼ˆæ¦‚è¿°ï¼‰

1ã€ç¼–ç é˜¶æ®µ

-   å°½é‡å‡å°‘ data ä¸­çš„æ•°æ®ï¼Œdata ä¸­çš„æ•°æ®éƒ½ä¼šå¢åŠ  getter å’Œ setterï¼Œä¼šæ”¶é›†å¯¹åº”çš„ watcher
-   v-if å’Œ v-for ä¸èƒ½è¿ç”¨
-   å¦‚æœéœ€è¦ä½¿ç”¨ v-for ç»™æ¯é¡¹å…ƒç´ ç»‘å®šäº‹ä»¶æ—¶ä½¿ç”¨äº‹ä»¶ä»£ç†
-   SPA é¡µé¢é‡‡ç”¨ keep-alive ç¼“å­˜ç»„ä»¶
-   åœ¨æ›´å¤šçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ v-if æ›¿ä»£ v-show
-   key ä¿è¯å”¯ä¸€
-   ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½ã€å¼‚æ­¥ç»„ä»¶
-   é˜²æŠ–ã€èŠ‚æµ
-   ç¬¬ä¸‰æ–¹æ¨¡å—æŒ‰éœ€å¯¼å…¥
-   é•¿åˆ—è¡¨æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸåŠ¨æ€åŠ è½½
-   å›¾ç‰‡æ‡’åŠ è½½
-   SEO ä¼˜åŒ–

2ã€é¢„æ¸²æŸ“

-   æœåŠ¡ç«¯æ¸²æŸ“ SSR
-   æ‰“åŒ…ä¼˜åŒ–

3ã€å‹ç¼©ä»£ç 

-   Tree Shaking/Scope Hoisting
-   ä½¿ç”¨ cdn åŠ è½½ç¬¬ä¸‰æ–¹æ¨¡å—
-   å¤šçº¿ç¨‹æ‰“åŒ… happypack
-   splitChunks æŠ½ç¦»å…¬å…±æ–‡ä»¶
-   sourceMap ä¼˜åŒ–

4ã€ç”¨æˆ·ä½“éªŒ

-   éª¨æ¶å±
-   PWA
-   è¿˜å¯ä»¥ä½¿ç”¨ç¼“å­˜(å®¢æˆ·ç«¯ç¼“å­˜ã€æœåŠ¡ç«¯ç¼“å­˜)ä¼˜åŒ–ã€æœåŠ¡ç«¯å¼€å¯ gzip å‹ç¼©ç­‰ã€‚

## hash è·¯ç”±å’Œ history è·¯ç”±å®ç°åŸç†è¯´ä¸€ä¸‹

location.hash çš„å€¼å®é™…å°±æ˜¯ URL ä¸­#åé¢çš„ä¸œè¥¿ã€‚

history å®é™…é‡‡ç”¨äº† HTML5 ä¸­æä¾›çš„ API æ¥å®ç°ï¼Œä¸»è¦æœ‰ history.pushState()å’Œ history.replaceState()ã€‚

vue æˆ– react æ¡†æ¶ç›¸å…³

vue å“åº”å¼åŸç†ä»¥åŠåŒå‘ç»‘å®šå®ç°ä»£ç  ?

vue3 å“åº”å¼åŸç†ï¼Œæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

vue çš„ diff ç®—æ³•æ€è·¯ï¼Œæ€ä¹ˆå¯¹æ¯”èŠ‚ç‚¹ï¼Ÿ

vue çš„ compile å®ç°ï¼Ÿ

vue å¦‚ä½•è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿå…·ä½“çš„ api å†™æ³•ï¼Ÿ

vue3 å¯¹äº vue2 åœ¨æ€§èƒ½ä¸Šçš„ä¼˜åŒ–ï¼ˆä» compile å’Œ runtime ä¸¤æ–¹é¢ï¼‰ï¼Ÿ

## Vue çˆ¶ç»„ä»¶å¯ä»¥ç›‘å¬åˆ°å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå—?

1ï¼‰å®ç°æ–¹å¼ä¸€

æ¯”å¦‚æœ‰çˆ¶ç»„ä»¶ Parent å’Œå­ç»„ä»¶ Childï¼Œå¦‚æœçˆ¶ç»„ä»¶ç›‘å¬åˆ°å­ç»„ä»¶æŒ‚è½½ mounted å°±åšä¸€äº›é€»è¾‘å¤„ç†ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å†™æ³•å®ç°ï¼š

```jsx
// Parent.vue
<Child @mounted="doSomething"/>

// Child.vue
mounted() {
  this.$emit("mounted");
}
```

2ï¼‰å®ç°æ–¹å¼äºŒ

ä»¥ä¸Šéœ€è¦æ‰‹åŠ¨é€šè¿‡ $emit è§¦å‘çˆ¶ç»„ä»¶çš„äº‹ä»¶ï¼Œæ›´ç®€å•çš„æ–¹å¼å¯ä»¥åœ¨çˆ¶ç»„ä»¶å¼•ç”¨å­ç»„ä»¶æ—¶é€šè¿‡ @hook æ¥ç›‘å¬å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```jsx
//  Parent.vue
<Child @hook:mounted="doSomething" ></Child>

doSomething() {
   console.log('çˆ¶ç»„ä»¶ç›‘å¬åˆ° mounted é’©å­å‡½æ•° ...');
},

//  Child.vue
mounted(){
   console.log('å­ç»„ä»¶è§¦å‘ mounted é’©å­å‡½æ•° ...');
},

// ä»¥ä¸Šè¾“å‡ºé¡ºåºä¸ºï¼š
// å­ç»„ä»¶è§¦å‘ mounted é’©å­å‡½æ•° ...
// çˆ¶ç»„ä»¶ç›‘å¬åˆ° mounted é’©å­å‡½æ•° ...
```

å½“ç„¶ @hook æ–¹æ³•ä¸ä»…ä»…æ˜¯å¯ä»¥ç›‘å¬ mountedï¼Œå…¶å®ƒçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œä¾‹å¦‚ï¼šcreatedï¼Œupdated ç­‰éƒ½å¯ä»¥ç›‘å¬ã€‚

## Vue ä¸ºä»€ä¹ˆè¦ç”¨ vm.$set() è§£å†³å¯¹è±¡æ–°å¢å±æ€§ä¸èƒ½å“åº”çš„é—®é¢˜ ï¼Ÿä½ èƒ½è¯´è¯´å¦‚ä¸‹ä»£ç çš„å®ç°åŸç†ä¹ˆ

Vue.set (object, propertyName, value)

vm.$set (object, propertyName, value)

1ï¼‰Vue ä¸ºä»€ä¹ˆè¦ç”¨ vm.$set() è§£å†³å¯¹è±¡æ–°å¢å±æ€§ä¸èƒ½å“åº”çš„é—®é¢˜

Vue ä½¿ç”¨äº† Object.defineProperty å®ç°åŒå‘æ•°æ®ç»‘å®š,åœ¨åˆå§‹åŒ–å®ä¾‹æ—¶å¯¹å±æ€§æ‰§è¡Œ getter/setter è½¬åŒ–,å±æ€§å¿…é¡»åœ¨ data å¯¹è±¡ä¸Šå­˜åœ¨æ‰èƒ½è®© Vue å°†å®ƒè½¬æ¢ä¸ºå“åº”å¼çš„ï¼ˆè¿™ä¹Ÿå°±é€ æˆäº† Vue æ— æ³•æ£€æµ‹åˆ°å¯¹è±¡å±æ€§çš„æ·»åŠ æˆ–åˆ é™¤ï¼‰

æ‰€ä»¥ Vue æä¾›äº† Vue.set (object, propertyName, value) / vm.\$set (object, propertyName, value)

```js
export function set(target: Array<any> | Object, key: any, val: any): any {
    // target ä¸ºæ•°ç»„
    if (Array.isArray(target) && isValidArrayIndex(key)) {
        // ä¿®æ”¹æ•°ç»„çš„é•¿åº¦, é¿å…ç´¢å¼•>æ•°ç»„é•¿åº¦å¯¼è‡´splcie()æ‰§è¡Œæœ‰è¯¯
        target.length = Math.max(target.length, key);
        // åˆ©ç”¨æ•°ç»„çš„spliceå˜å¼‚æ–¹æ³•è§¦å‘å“åº”å¼
        target.splice(key, 1, val);
        return val;
    }
    // key å·²ç»å­˜åœ¨ï¼Œç›´æ¥ä¿®æ”¹å±æ€§å€¼
    if (key in target && !(key in Object.prototype)) {
        target[key] = val;
        return val;
    }
    const ob = (target: any).__ob__;
    // target æœ¬èº«å°±ä¸æ˜¯å“åº”å¼æ•°æ®, ç›´æ¥èµ‹å€¼
    if (!ob) {
        target[key] = val;
        return val;
    }
    // å¯¹å±æ€§è¿›è¡Œå“åº”å¼å¤„ç†
    defineReactive(ob.value, key, val);
    ob.dep.notify();
    return val;
}
```

1.å¦‚æœç›®æ ‡æ˜¯æ•°ç»„ï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„çš„ splice æ–¹æ³•è§¦å‘ç›¸åº”å¼ï¼›

2.å¦‚æœç›®æ ‡æ˜¯å¯¹è±¡ï¼Œä¼šå…ˆåˆ¤è¯»å±æ€§æ˜¯å¦å­˜åœ¨ã€å¯¹è±¡æ˜¯å¦æ˜¯å“åº”å¼ï¼Œ

3.æœ€ç»ˆå¦‚æœè¦å¯¹å±æ€§è¿›è¡Œå“åº”å¼å¤„ç†ï¼Œåˆ™æ˜¯é€šè¿‡è°ƒç”¨ defineReactive æ–¹æ³•è¿›è¡Œå“åº”å¼å¤„ç†

## keep-alive

-   keep-alive æ˜¯ Vue å†…ç½®çš„ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ä½¿è¢«åŒ…å«çš„ç»„ä»¶ä¿ç•™çŠ¶æ€ï¼Œé¿å…é‡æ–°æ¸²æŸ“
-   ä¸€èˆ¬ç»“åˆè·¯ç”±å’ŒåŠ¨æ€ç»„ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºç¼“å­˜ç»„ä»¶ï¼›
-   æä¾› include å’Œ exclude å±æ€§ï¼Œä¸¤è€…éƒ½æ”¯æŒå­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œ include è¡¨ç¤ºåªæœ‰åç§°åŒ¹é…çš„ç»„ä»¶ä¼šè¢«ç¼“å­˜ï¼Œexclude è¡¨ç¤ºä»»ä½•åç§°åŒ¹é…çš„ç»„ä»¶éƒ½ä¸ä¼šè¢«ç¼“å­˜ ï¼Œå…¶ä¸­ exclude çš„ä¼˜å…ˆçº§æ¯” include é«˜ï¼›
-   å¯¹åº”ä¸¤ä¸ªé’©å­å‡½æ•° activated å’Œ deactivated ï¼Œå½“ç»„ä»¶è¢«æ¿€æ´»æ—¶ï¼Œè§¦å‘é’©å­å‡½æ•° activatedï¼Œå½“ç»„ä»¶è¢«ç§»é™¤æ—¶ï¼Œè§¦å‘é’©å­å‡½æ•° deactivatedã€‚

åŸç†ï¼š

```js
// æºç ä½ç½®ï¼šsrc/core/components/keep-alive.js
export default {
    name: 'keep-alive',
    abstract: true, // åˆ¤æ–­å½“å‰ç»„ä»¶è™šæ‹Ÿdomæ˜¯å¦æ¸²æŸ“æˆçœŸæ˜¯domçš„å…³é”®

    props: {
        include: patternTypes, // ç¼“å­˜ç™½åå•
        exclude: patternTypes, // ç¼“å­˜é»‘åå•
        max: [String, Number], // ç¼“å­˜çš„ç»„ä»¶å®ä¾‹æ•°é‡ä¸Šé™
    },

    created() {
        this.cache = Object.create(null); // ç¼“å­˜è™šæ‹Ÿdom
        this.keys = []; // ç¼“å­˜çš„è™šæ‹Ÿdomçš„å¥é›†åˆ
    },

    destroyed() {
        for (const key in this.cache) {
            // åˆ é™¤æ‰€æœ‰çš„ç¼“å­˜
            pruneCacheEntry(this.cache, key, this.keys);
        }
    },

    mounted() {
        // å®æ—¶ç›‘å¬é»‘ç™½åå•çš„å˜åŠ¨
        this.$watch('include', val => {
            pruneCache(this, name => matches(val, name));
        });
        this.$watch('exclude', val => {
            pruneCache(this, name => !matches(val, name));
        });
    },

    render() {
        // .....
    },
};
```

å¤§æ¦‚çš„åˆ†ææºç ï¼Œæˆ‘ä»¬å‘ç°ä¸æˆ‘ä»¬å®šä¹‰ç»„ä»¶çš„è¿‡ç¨‹ä¸€æ ·ï¼Œå…ˆæ˜¯è®¾ç½®ç»„ä»¶åä¸º keep-aliveï¼Œå…¶æ¬¡å®šä¹‰äº†ä¸€ä¸ª abstract å±æ€§ï¼Œå€¼ä¸º trueã€‚è¿™ä¸ªå±æ€§åœ¨ vue çš„å®˜æ–¹æ•™ç¨‹å¹¶æœªæåŠï¼Œå…¶å®æ˜¯ä¸€ä¸ªè™šç»„ä»¶ï¼Œåé¢æ¸²æŸ“è¿‡ç¨‹ä¼šåˆ©ç”¨è¿™ä¸ªå±æ€§ã€‚props å±æ€§å®šä¹‰äº† keep-alive ç»„ä»¶æ”¯æŒçš„å…¨éƒ¨å‚æ•°ã€‚

æ¥ä¸‹æ¥é‡ç‚¹å°±æ˜¯ keep-alive åœ¨å®ƒç”Ÿå‘½å‘¨æœŸå†…å®šä¹‰äº†ä¸‰ä¸ªé’©å­å‡½æ•°äº†

-   created

åˆå§‹åŒ–ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«ç¼“å­˜ VNodeï¼ˆè™šæ‹Ÿ DOMï¼‰å’Œ VNode å¯¹åº”çš„é”®é›†åˆ

-   destroyed

åˆ é™¤ç¼“å­˜ VNode è¿˜è¦å¯¹åº”æ‰§è¡Œç»„ä»¶å®ä¾‹çš„ destory é’©å­å‡½æ•°ã€‚

åˆ é™¤ this.cache ä¸­ç¼“å­˜çš„ VNode å®ä¾‹ã€‚ä¸æ˜¯ç®€å•åœ°å°† this.cache ç½®ä¸º nullï¼Œè€Œæ˜¯éå†è°ƒç”¨ pruneCacheEntry å‡½æ•°åˆ é™¤ã€‚

```js
// src/core/components/keep-alive.js
function pruneCacheEntry(cache: VNodeCache, key: string, keys: Array<string>, current?: VNode) {
    const cached = cache[key];
    if (cached && (!current || cached.tag !== current.tag)) {
        cached.componentInstance.$destroy(); // æ‰§è¡Œç»„ä»¶çš„ destory é’©å­å‡½æ•°
    }
    cache[key] = null;
    remove(keys, key);
}
```

-   mounted

åœ¨ mounted è¿™ä¸ªé’©å­ä¸­å¯¹ include å’Œ exclude å‚æ•°è¿›è¡Œç›‘å¬ï¼Œç„¶åå®æ—¶åœ°æ›´æ–°ï¼ˆåˆ é™¤ï¼‰this.cache å¯¹è±¡æ•°æ®ã€‚pruneCache å‡½æ•°çš„æ ¸å¿ƒä¹Ÿæ˜¯å»è°ƒç”¨ pruneCacheEntryã€‚

**render**

```js
// src/core/components/keep-alive.js
render () {
const slot = this.$slots.default
const vnode: VNode = getFirstComponentChild(slot) // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå­ç»„ä»¶å¯¹è±¡
const componentOptions: ?VNodeComponentOptions = vnode && vnode.componentOptions
if (componentOptions) { // å­˜åœ¨ç»„ä»¶å‚æ•°
    // check pattern
    const name: ?string = getComponentName(componentOptions) // ç»„ä»¶å
    const { include, exclude } = this
    if ( // æ¡ä»¶åŒ¹é…
    // not included
    (include && (!name || !matches(include, name))) ||
    // excluded
    (exclude && name && matches(exclude, name))
    ) {
    return vnode
    }

    const { cache, keys } = this
    const key: ?string = vnode.key == null // å®šä¹‰ç»„ä»¶çš„ç¼“å­˜key
    // same constructor may get registered as different local components
    // so cid alone is not enough (#3269)
    ? componentOptions.Ctor.cid + (componentOptions.tag ? `::${componentOptions.tag}` : '')
    : vnode.key
    if (cache[key]) { // å·²ç»ç¼“å­˜è¿‡è¯¥ç»„ä»¶
    vnode.componentInstance = cache[key].componentInstance
    // make current key freshest
    remove(keys, key)
    keys.push(key) // è°ƒæ•´keyæ’åº
    } else {
    cache[key] = vnode // ç¼“å­˜ç»„ä»¶å¯¹è±¡
    keys.push(key)
    // prune oldest entry
    if (this.max && keys.length > parseInt(this.max)) {
        // è¶…è¿‡ç¼“å­˜æ•°é™åˆ¶ï¼Œå°†ç¬¬ä¸€ä¸ªåˆ é™¤ï¼ˆLRUç¼“å­˜ç®—æ³•ï¼‰
        pruneCacheEntry(cache, keys[0], keys, this._vnode)
    }
    }

    vnode.data.keepAlive = true // æ¸²æŸ“å’Œæ‰§è¡Œè¢«åŒ…è£¹ç»„ä»¶çš„é’©å­å‡½æ•°éœ€è¦ç”¨åˆ°
}
return vnode || (slot && slot[0])
}
```

ç¬¬ä¸€æ­¥ï¼šè·å– keep-alive åŒ…è£¹ç€çš„ç¬¬ä¸€ä¸ªå­ç»„ä»¶å¯¹è±¡åŠå…¶ç»„ä»¶åï¼›

ç¬¬äºŒæ­¥ï¼šæ ¹æ®è®¾å®šçš„é»‘ç™½åå•ï¼ˆå¦‚æœæœ‰ï¼‰è¿›è¡Œæ¡ä»¶åŒ¹é…ï¼Œå†³å®šæ˜¯å¦ç¼“å­˜ã€‚ä¸åŒ¹é…ï¼Œç›´æ¥è¿”å›ç»„ä»¶å®ä¾‹ï¼ˆVNodeï¼‰ï¼Œå¦åˆ™æ‰§è¡Œç¬¬ä¸‰æ­¥ï¼›

ç¬¬ä¸‰æ­¥ï¼šæ ¹æ®ç»„ä»¶ ID å’Œ tag ç”Ÿæˆç¼“å­˜ Keyï¼Œå¹¶åœ¨ç¼“å­˜å¯¹è±¡ä¸­æŸ¥æ‰¾æ˜¯å¦å·²ç¼“å­˜è¿‡è¯¥ç»„ä»¶å®ä¾‹ã€‚å¦‚æœå­˜åœ¨ï¼Œç›´æ¥å–å‡ºç¼“å­˜å€¼å¹¶æ›´æ–°è¯¥ key åœ¨ this.keys ä¸­çš„ä½ç½®ï¼ˆæ›´æ–° key çš„ä½ç½®æ˜¯å®ç° LRU ç½®æ¢ç­–ç•¥çš„å…³é”®ï¼‰ï¼Œå¦åˆ™æ‰§è¡Œç¬¬å››æ­¥ï¼›

ç¬¬å››æ­¥ï¼šåœ¨ this.cache å¯¹è±¡ä¸­å­˜å‚¨è¯¥ç»„ä»¶å®ä¾‹å¹¶ä¿å­˜ key å€¼ï¼Œä¹‹åæ£€æŸ¥ç¼“å­˜çš„å®ä¾‹æ•°é‡æ˜¯å¦è¶…è¿‡ max çš„è®¾ç½®å€¼ï¼Œè¶…è¿‡åˆ™æ ¹æ® LRU ç½®æ¢ç­–ç•¥åˆ é™¤æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„å®ä¾‹ï¼ˆå³æ˜¯ä¸‹æ ‡ä¸º 0 çš„é‚£ä¸ª keyï¼‰ã€‚

ç¬¬äº”æ­¥ï¼šæœ€åå¹¶ä¸”å¾ˆé‡è¦ï¼Œå°†è¯¥ç»„ä»¶å®ä¾‹çš„ keepAlive å±æ€§å€¼è®¾ç½®ä¸º trueã€‚

æœ€åå°±æ˜¯å†æ¬¡æ¸²æŸ“æ‰§è¡Œç¼“å­˜å’Œå¯¹åº”é’©å­å‡½æ•°äº†

## Vue v-model æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¯­æ³•ç³–

åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸­ï¼Œv-model é»˜è®¤ä¼šåˆ©ç”¨åä¸º value çš„ prop å’Œåä¸º input çš„äº‹ä»¶

æœ¬è´¨æ˜¯ä¸€ä¸ªçˆ¶å­ç»„ä»¶é€šä¿¡çš„è¯­æ³•ç³–ï¼Œé€šè¿‡ prop å’Œ\$.emit å®ç°

## å¯¹è™šæ‹Ÿ DOM çš„ç†è§£

### ä¸€ã€ä»€ä¹ˆæ˜¯è™šæ‹Ÿ Dom

ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒVirtual Dom æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œé€šè¿‡å¯¹è±¡çš„æ–¹å¼æ¥è¡¨ç¤º DOM ç»“æ„ã€‚å°†é¡µé¢çš„çŠ¶æ€æŠ½è±¡ä¸º JS å¯¹è±¡çš„å½¢å¼ï¼Œé…åˆä¸åŒçš„æ¸²æŸ“å·¥å…·ï¼Œä½¿è·¨å¹³å°æ¸²æŸ“æˆä¸ºå¯èƒ½ã€‚é€šè¿‡äº‹åŠ¡å¤„ç†æœºåˆ¶ï¼Œå°†å¤šæ¬¡ DOM ä¿®æ”¹çš„ç»“æœä¸€æ¬¡æ€§çš„æ›´æ–°åˆ°é¡µé¢ä¸Šï¼Œä»è€Œæœ‰æ•ˆçš„å‡å°‘é¡µé¢æ¸²æŸ“çš„æ¬¡æ•°ï¼Œå‡å°‘ä¿®æ”¹ DOM çš„é‡ç»˜é‡æ’æ¬¡æ•°ï¼Œæé«˜æ¸²æŸ“æ€§èƒ½ã€‚

è™šæ‹Ÿ dom æ˜¯å¯¹ DOM çš„æŠ½è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯æ›´åŠ è½»é‡çº§çš„å¯¹ DOM çš„æè¿°ã€‚å®ƒè®¾è®¡çš„æœ€åˆç›®çš„ï¼Œå°±æ˜¯æ›´å¥½çš„è·¨å¹³å°ï¼Œæ¯”å¦‚ Node.js å°±æ²¡æœ‰ DOM,å¦‚æœæƒ³å®ç° SSR,é‚£ä¹ˆä¸€ä¸ªæ–¹å¼å°±æ˜¯å€ŸåŠ©è™šæ‹Ÿ dom, å› ä¸ºè™šæ‹Ÿ dom æœ¬èº«æ˜¯ js å¯¹è±¡ã€‚

åœ¨ä»£ç æ¸²æŸ“åˆ°é¡µé¢ä¹‹å‰ï¼Œvue æˆ–è€… react ä¼šæŠŠä»£ç è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ï¼ˆè™šæ‹Ÿ DOMï¼‰ã€‚ä»¥å¯¹è±¡çš„å½¢å¼æ¥æè¿°çœŸå® dom ç»“æ„ï¼Œæœ€ç»ˆæ¸²æŸ“åˆ°é¡µé¢ã€‚åœ¨æ¯æ¬¡æ•°æ®å‘ç”Ÿå˜åŒ–å‰ï¼Œè™šæ‹Ÿ dom éƒ½ä¼šç¼“å­˜ä¸€ä»½ï¼Œå˜åŒ–ä¹‹æ—¶ï¼Œç°åœ¨çš„è™šæ‹Ÿ dom ä¼šä¸ç¼“å­˜çš„è™šæ‹Ÿ dom è¿›è¡Œæ¯”è¾ƒã€‚

åœ¨ vue æˆ–è€… react å†…éƒ¨å°è£…äº† diff ç®—æ³•ï¼Œé€šè¿‡è¿™ä¸ªç®—æ³•æ¥è¿›è¡Œæ¯”è¾ƒï¼Œæ¸²æŸ“æ—¶ä¿®æ”¹æ”¹å˜çš„å˜åŒ–ï¼ŒåŸå…ˆæ²¡æœ‰å‘ç”Ÿæ”¹å˜çš„é€šè¿‡åŸå…ˆçš„æ•°æ®è¿›è¡Œæ¸²æŸ“ã€‚

å¦å¤–ç°ä»£å‰ç«¯æ¡†æ¶çš„ä¸€ä¸ªåŸºæœ¬è¦æ±‚å°±æ˜¯æ— é¡»æ‰‹åŠ¨æ“ä½œ DOM,ä¸€æ–¹é¢æ˜¯å› ä¸ºæ‰‹åŠ¨æ“ä½œ DOM æ— æ³•ä¿è¯ç¨‹åºæ€§èƒ½ï¼Œå¤šäººåä½œçš„é¡¹ç›®ä¸­å¦‚æœ review ä¸ä¸¥æ ¼ï¼Œå¯èƒ½ä¼šæœ‰å¼€å‘è€…å†™å‡ºæ€§èƒ½è¾ƒä½çš„ä»£ç ï¼Œå¦ä¸€æ–¹é¢æ›´é‡è¦çš„æ˜¯çœç•¥æ‰‹åŠ¨ DOM æ“ä½œå¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚

### äºŒã€ä¸ºä»€ä¹ˆè¦ç”¨ Virtual DOM

1.ä¿è¯æ€§èƒ½ä¸‹é™ï¼Œåœ¨ä¸è¿›è¡Œæ‰‹åŠ¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæä¾›è¿‡å¾—å»çš„æ€§èƒ½

çœ‹ä¸€ä¸‹é¡µé¢æ¸²æŸ“çš„ä¸€ä¸ªæµç¨‹ï¼š

è§£æ HTNL â˜ ç”Ÿæˆ DOMğŸŒ² â˜ ç”Ÿæˆ CSSOM â˜ Layout â˜ Paint â˜ Compiler

ä¸‹é¢å¯¹æ¯”ä¸€ä¸‹ä¿®æ”¹ DOM æ—¶çœŸå® DOM æ“ä½œå’Œ Virtual DOM çš„è¿‡ç¨‹ï¼Œæ¥çœ‹ä¸€ä¸‹å®ƒä»¬é‡æ’é‡ç»˜çš„æ€§èƒ½æ¶ˆè€—ï¼š

çœŸå® DOMï¼š ç”Ÿæˆ HTML å­—ç¬¦ä¸² + é‡å»ºæ‰€æœ‰çš„ DOM å…ƒç´ 

Virtual DOMï¼š ç”Ÿæˆ vNode + DOMDiff + å¿…è¦çš„ dom æ›´æ–°

Virtual DOM çš„æ›´æ–° DOM çš„å‡†å¤‡å·¥ä½œè€—è´¹æ›´å¤šçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ JS å±‚é¢ï¼Œç›¸æ¯”äºæ›´å¤šçš„ DOM æ“ä½œå®ƒçš„æ¶ˆè´¹æ˜¯æå…¶ä¾¿å®œçš„ã€‚å°¤é›¨æºªåœ¨ç¤¾åŒºè®ºå›ä¸­è¯´é“ï¼š æ¡†æ¶ç»™ä½ çš„ä¿è¯æ˜¯ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¾ç„¶å¯ä»¥ç»™ä½ æä¾›è¿‡å¾—å»çš„æ€§èƒ½ã€‚

2.è·¨å¹³å°

Virtual DOM æœ¬è´¨ä¸Šæ˜¯ JavaScript çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿çš„è·¨å¹³å°æ“ä½œï¼Œæ¯”å¦‚æœåŠ¡ç«¯æ¸²æŸ“ã€uniapp ç­‰ã€‚

### ä¸‰ã€Virtual DOM çœŸçš„æ¯”çœŸå® DOM æ€§èƒ½å¥½å—

é¦–æ¬¡æ¸²æŸ“å¤§é‡ DOM æ—¶ï¼Œç”±äºå¤šäº†ä¸€å±‚è™šæ‹Ÿ DOM çš„è®¡ç®—ï¼Œä¼šæ¯” innerHTML æ’å…¥æ…¢ã€‚
æ­£å¦‚å®ƒèƒ½ä¿è¯æ€§èƒ½ä¸‹é™ï¼Œåœ¨çœŸå® DOM æ“ä½œçš„æ—¶å€™è¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–æ—¶ï¼Œè¿˜æ˜¯æ›´å¿«çš„ã€‚

## vue-router çš„åŸç†

å®ç°åŸç†
vue-router çš„åŸç†å°±æ˜¯æ›´æ–°è§†å›¾è€Œä¸é‡æ–°è¯·æ±‚é¡µé¢ã€‚

vue-router å¯ä»¥é€šè¿‡ mode å‚æ•°è®¾ç½®ä¸ºä¸‰ç§æ¨¡å¼ï¼šhash æ¨¡å¼ã€history æ¨¡å¼ã€abstract æ¨¡å¼ ã€‚

### 1.hash æ¨¡å¼

é»˜è®¤æ˜¯ hash æ¨¡å¼,åŸºäºæµè§ˆå™¨ history apiï¼Œä½¿ç”¨ window.addEventListener("hashchange",callback,false) å¯¹æµè§ˆå™¨åœ°å€è¿›è¡Œç›‘å¬ã€‚å½“è°ƒç”¨ push æ—¶ï¼ŒæŠŠæ–°è·¯ç”±æ·»åŠ åˆ°æµè§ˆå™¨è®¿é—®å†å²çš„æ ˆé¡¶ã€‚ä½¿ç”¨ replace æ—¶ï¼ŒæŠŠæµè§ˆå™¨è®¿é—®å†å²çš„æ ˆé¡¶è·¯ç”±æ›¿æ¢æˆæ–°è·¯ç”±ã€‚

hash å€¼ç­‰äº url ä¸­#åŠå…¶ä»¥åçš„å†…å®¹ã€‚æµè§ˆå™¨æ˜¯æ ¹æ® hash å€¼çš„å˜åŒ–ï¼Œå°†é¡µé¢åŠ è½½åˆ°ç›¸åº”çš„ DOM ä½ç½®ã€‚é”šç‚¹å˜åŒ–åªæ˜¯æµè§ˆå™¨çš„è¡Œä¸ºï¼Œæ¯æ¬¡é”šç‚¹å˜åŒ–åä¾ç„¶ä¼šåœ¨æµè§ˆå™¨ä¸­ç•™ä¸‹ä¸€æ¡å†å²è®°å½•ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨çš„åé€€æŒ‰é’®å›åˆ°ä¸Šä¸€ä¸ªä½ç½®ã€‚

### 2.History

history æ¨¡å¼ï¼ŒåŸºäºæµè§ˆå™¨ history apiï¼Œä½¿ç”¨ window.onpopstate å¯¹æµè§ˆå™¨åœ°å€è¿›è¡Œç›‘å¬ã€‚å¯¹æµè§ˆå™¨ history api ä¸­ pushState()ã€replaceState() è¿›è¡Œå°è£…ï¼Œ
å½“æ–¹æ³•è°ƒç”¨ï¼Œä¼šå¯¹æµè§ˆå™¨å†å²æ ˆè¿›è¡Œä¿®æ”¹ã€‚ä»è€Œå®ç° URL çš„è·³è½¬è€Œæ— éœ€é‡æ–°åŠ è½½é¡µé¢ã€‚

ä½†æ˜¯å®ƒçš„é—®é¢˜åœ¨äºå½“åˆ·æ–°é¡µé¢çš„æ—¶å€™ä¼šèµ°åç«¯è·¯ç”±ï¼Œæ‰€ä»¥éœ€è¦æœåŠ¡ç«¯çš„è¾…åŠ©æ¥å…œåº•ï¼Œé¿å… URL æ— æ³•åŒ¹é…åˆ°èµ„æºæ—¶èƒ½è¿”å›é¡µé¢ã€‚

### 3.abstract

ä¸æ¶‰åŠå’Œæµè§ˆå™¨åœ°å€çš„ç›¸å…³è®°å½•ã€‚æµç¨‹è·Ÿ hash æ¨¡å¼ä¸€æ ·ï¼Œé€šè¿‡æ•°ç»„ç»´æŠ¤æ¨¡æ‹Ÿæµè§ˆå™¨çš„å†å²è®°å½•æ ˆã€‚

æœåŠ¡ç«¯ä¸‹ä½¿ç”¨ã€‚ä½¿ç”¨ä¸€ä¸ªä¸ä¾èµ–äºæµè§ˆå™¨çš„æµè§ˆå†å²è™šæ‹Ÿç®¡ç†åå°ã€‚

4.æ€»ç»“
hash æ¨¡å¼å’Œ history æ¨¡å¼éƒ½æ˜¯é€šè¿‡ window.addEventListenter() æ–¹æ³•ç›‘å¬ hashchange å’Œ popState è¿›è¡Œç›¸åº”è·¯ç”±çš„æ“ä½œã€‚å¯ä»¥é€šè¿‡ backã€fowardã€go ç­‰æ–¹æ³•è®¿é—®æµè§ˆå™¨çš„å†å²è®°å½•æ ˆï¼Œè¿›è¡Œå„ç§è·³è½¬ã€‚è€Œ abstract æ¨¡å¼æ˜¯è‡ªå·±ç»´æŠ¤ä¸€ä¸ªæ¨¡æ‹Ÿçš„æµè§ˆå™¨å†å²è®°å½•æ ˆçš„æ•°ç»„ã€‚





## Vue data ä¸­æŸä¸€ä¸ªå±æ€§çš„å€¼å‘ç”Ÿæ”¹å˜åï¼Œè§†å›¾ä¼šç«‹å³åŒæ­¥æ‰§è¡Œé‡æ–°æ¸²æŸ“å—ï¼Ÿ

å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—,Vue åœ¨æ›´æ–° DOM æ—¶æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå½“ä½ è®¾ç½® vm.someData = 'new value'ï¼Œè¯¥ç»„ä»¶ä¸ä¼šç«‹å³é‡æ–°æ¸²æŸ“ï¼Œå¯ä»¥åœ¨æ•°æ®å˜åŒ–ä¹‹åç«‹å³ä½¿ç”¨ Vue.nextTick(callback)ã€‚è¿™æ ·å›è°ƒå‡½æ•°å°†åœ¨ DOM æ›´æ–°å®Œæˆåè¢«è°ƒç”¨ã€‚

ä¸ä¼šç«‹å³åŒæ­¥æ‰§è¡Œé‡æ–°æ¸²æŸ“ã€‚Vue å®ç°å“åº”å¼å¹¶ä¸æ˜¯æ•°æ®å‘ç”Ÿå˜åŒ–ä¹‹å DOM ç«‹å³å˜åŒ–ï¼Œè€Œæ˜¯æŒ‰ä¸€å®šçš„ç­–ç•¥è¿›è¡Œ DOM çš„æ›´æ–°ã€‚Vue åœ¨æ›´æ–° DOM æ—¶æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚åªè¦ä¾¦å¬åˆ°æ•°æ®å˜åŒ–ï¼Œ Vue å°†å¼€å¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ç¼“å†²åœ¨åŒä¸€äº‹ä»¶å¾ªç¯ä¸­å‘ç”Ÿçš„æ‰€æœ‰æ•°æ®å˜æ›´ã€‚

å¦‚æœåŒä¸€ä¸ªwatcherè¢«å¤šæ¬¡è§¦å‘ï¼Œåªä¼šè¢«æ¨å…¥åˆ°é˜Ÿåˆ—ä¸­ä¸€æ¬¡ã€‚è¿™ç§åœ¨ç¼“å†²æ—¶å»é™¤é‡å¤æ•°æ®å¯¹äºé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ DOM æ“ä½œæ˜¯éå¸¸é‡è¦çš„ã€‚ç„¶åï¼Œåœ¨ä¸‹ä¸€ä¸ªçš„äº‹ä»¶å¾ªç¯tickä¸­ï¼ŒVue åˆ·æ–°é˜Ÿåˆ—å¹¶æ‰§è¡Œå®é™…ï¼ˆå·²å»é‡çš„ï¼‰å·¥ä½œã€‚





## Vue3 ä¸ Vue2 çš„å¯¹æ¯”

**Vue2çš„ç¼ºç‚¹ï¼š**

1. Mixin,ç‰¹åˆ«å®¹æ˜“å‘ç”Ÿå‘½åå†²çªï¼Œæš´éœ²å‡ºæ¥çš„å˜é‡æ„å›¾ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œé‡ç”¨åˆ°å…¶ä»–ç»„ä»¶å®¹æ˜“å†²çªã€‚
2. vue2å¯¹äºtypeScriptçš„æ”¯æŒéå¸¸æœ‰é™ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°tsçš„é›†æˆã€‚
3. vue3çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³vue2çš„å¼Šç«¯ï¼Œå…¶composition APIå¾ˆå¥½çš„è§£å†³äº†é€»è¾‘å¤ç”¨çš„é—®é¢˜ï¼Œè€Œä¸”vue3æºç å°±æ˜¯ç”¨tså†™çš„ï¼Œå¯¹tsçš„æ”¯æŒéå¸¸å¥½ã€‚æˆ‘ä»¬åœ¨å¼€å‘é¡¹ç›®è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨tsçš„åŠ æŒï¼Œä½¿ä»£ç æ›´åŠ å¥å£®ã€‚

**vue3çš„ä¼˜ç‚¹**

1. vue3æ”¯æŒvue2çš„å¤§å¤šæ•°ç‰¹æ€§ï¼Œå®ç°å¯¹vue2çš„å…¼å®¹
2. vue3å¯¹æ¯”vue2å…·æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡
3. æ‰“åŒ…å¤§å°å‡å°‘41%
4. åˆæ¬¡æ¸²æŸ“å¿«55%ï¼Œæ›´æ–°å¿«133%
5. å†…å­˜ä½¿ç”¨å‡å°‘54%
6. vue3å…·æœ‰çš„composition APIå®ç°é€»è¾‘æ¨¡å—åŒ–å’Œé‡ç”¨
7. å¢åŠ äº†æ–°ç‰¹æ€§ï¼Œå¦‚Teleportç»„ä»¶ï¼Œå…¨å±€APIçš„ä¿®æ”¹å’Œä¼˜åŒ–ç­‰

**å“åº”å¼åŸç†çš„ä¸åŒ**
Vue2.xå®ç°åŒå‘æ•°æ®ç»‘å®šåŸç†ï¼Œæ˜¯é€šè¿‡es5çš„ Object.definePropertyï¼Œæ ¹æ®å…·ä½“çš„keyå»è¯»å–å’Œä¿®æ”¹ã€‚å…¶ä¸­çš„setteræ–¹æ³•æ¥å®ç°æ•°æ®åŠ«æŒçš„ï¼Œgetterå®ç°æ•°æ®çš„ä¿®æ”¹ã€‚ä½†æ˜¯å¿…é¡»å…ˆçŸ¥é“æƒ³è¦æ‹¦æˆªå’Œä¿®æ”¹çš„keyæ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥vue2å¯¹äºæ–°å¢çš„å±æ€§æ— èƒ½ä¸ºåŠ›ï¼Œæ¯”å¦‚æ— æ³•ç›‘å¬å±æ€§çš„æ·»åŠ å’Œåˆ é™¤ã€æ•°ç»„ç´¢å¼•å’Œé•¿åº¦çš„å˜æ›´ï¼Œvue2çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨Vue.set(object, propertyName, value) ç­‰æ–¹æ³•å‘åµŒå¥—å¯¹è±¡æ·»åŠ å“åº”å¼ã€‚

Vue3.xä½¿ç”¨äº†ES2015çš„æ›´å¿«çš„åŸç”Ÿproxy æ›¿ä»£ Object.definePropertyã€‚Proxyå¯ä»¥ç†è§£æˆï¼Œåœ¨å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚Proxyå¯ä»¥ç›´æ¥ç›‘å¬å¯¹è±¡è€Œéå±æ€§ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå…·æœ‰æ›´å¥½çš„å“åº”å¼æ”¯æŒ

**ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒ**

```javascript
beforeCreate -> è¯·ä½¿ç”¨ setup()
created -> è¯·ä½¿ç”¨ setup()
beforeMount -> onBeforeMount
mounted -> onMounted
beforeUpdate -> onBeforeUpdate
updated -> onUpdated
beforeDestroy -> onBeforeUnmount
destroyed -> onUnmounted
errorCaptured -> onErrorCaptured
```

å¦‚æœè¦æƒ³åœ¨é¡µé¢ä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä»¥å¾€vue2çš„æ“ä½œæ˜¯ç›´æ¥åœ¨é¡µé¢ä¸­å†™å…¥ç”Ÿå‘½å‘¨æœŸï¼Œè€Œvue3æ˜¯éœ€è¦å»å¼•ç”¨çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ3èƒ½å¤Ÿå°†ä»£ç å‹ç¼©åˆ°æ›´ä½çš„åŸå› 

**é»˜è®¤é¡¹ç›®ç›®å½•ç»“æ„çš„ä¸åŒ**
vue3ç§»é™¤äº†é…ç½®æ–‡ä»¶ç›®å½•ï¼Œconfig å’Œ build æ–‡ä»¶å¤¹ï¼Œç§»é™¤äº† static æ–‡ä»¶å¤¹ï¼Œæ–°å¢ public æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸” index.html ç§»åŠ¨åˆ° public ä¸­ï¼Œåœ¨ src æ–‡ä»¶å¤¹ä¸­æ–°å¢äº† views æ–‡ä»¶å¤¹ï¼Œç”¨äºåˆ†ç±»è§†å›¾ç»„ä»¶å’Œå…¬å…±ç»„ä»¶

**vue3å¯¹å…¨å±€APIçš„ä¼˜åŒ–**
åœ¨ Vue3 ä¸­ï¼Œå…¨å±€å’Œå†…éƒ¨ API éƒ½ç»è¿‡äº†é‡æ„ï¼Œå¹¶è€ƒè™‘åˆ°äº† tree-shaking çš„æ”¯æŒã€‚å› æ­¤ï¼Œå…¨å±€ APIç°åœ¨åªèƒ½ä½œä¸º ES æ¨¡å—æ„å»ºçš„å‘½åå¯¼å‡ºè¿›è¡Œè®¿é—®ã€‚

```javascript
import { nextTick } from 'vue'
nextTick(() => {
  // ä¸€äº›å’ŒDOMæœ‰å…³çš„ä¸œè¥¿
})
```

vue2å†™æ³•
vue2å…¨å±€é…ç½®çš„ä¿®æ”¹ï¼Œä¼šä¿®æ”¹Vueå¯¹è±¡çš„å±æ€§
åœ¨ä¸åŒçš„appä¸­ï¼Œå…±äº«ä¸€ä»½æœ‰ç€ä¸åŒé…ç½®çš„Vueå¯¹è±¡ï¼Œä¹Ÿå˜å¾—éå¸¸å›°éš¾

```javascript
import Vue from 'vue'
import App from './App.vue'
Vue.config.xx=xx
Vue.use(...)
Vue.mixin(...)

new Vue({
  render:h=>h(app)
}).$mount('#app')

// vue3å†™æ³•
import { createApp } from 'vue'
import App from './App.vue'
const app = createApp(APP) // åˆ›å»ºä¸€ä¸ªappå®ä¾‹
app.config.xx=xx  // åœ¨å®ä¾‹ä¸Šä¿®æ”¹é…ç½®ï¼Œä¸ä¼šå‘ç”Ÿå†²çª
app.use(...)
app.mixin(...)
app.mount('#app')
```





## çœŸå® dom è½¬å˜ä¸ºè™šæ‹Ÿ domï¼Œä»£ç å®ç°



## Vue å®šä¹‰å…¨å±€æ–¹æ³•

`Vue.prototype[method]=method`

`é€šè¿‡mixinï¼ŒVue.mixin(mixins)`

`é€šè¿‡æ’ä»¶Vue.use(plugin)`

## æ˜¾ç¤ºå†…å®¹ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

```
<template>
  <div>{{a.b}}</div>
</template>

<script>
export default {
  data () {
    return {
      a: {}
    }
  },
  created () {
    this.a.b = 1
  },
  mounted () {
    this.a.b = 2
  }
}
</script>
```

ç­”æ¡ˆï¼š1
vueåˆå§‹åŒ–å®ä¾‹æ˜¯ï¼Œå¯¹dataå¯¹è±¡ä¸Šçš„å±æ€§ï¼Œè¿›è¡Œpropertyæ‰§è¡Œsetterã€getterç›‘å¬ï¼Œæ‰€ä»¥bå±æ€§æœªè¢«ç›‘å¬åˆ°
