# é—­åŒ…å’Œå‡½æ•°æŸ¯é‡ŒåŒ–

## é—­åŒ…æ˜¯ä»€ä¹ˆ

é—­åŒ…`ï¼ˆclosureï¼‰`æ˜¯ `JavaScript` çš„éš¾ç‚¹ï¼Œä¹Ÿæ˜¯å®ƒçš„ç‰¹è‰²ã€‚æ˜¯å·ç§° `JS` é¢è¯•ä¸‰åº§å¤§å±±ï¼ˆ**åŸå‹ä¸åŸå‹é“¾**ï¼Œ**ä½œç”¨åŸŸåŠé—­åŒ…**ï¼Œ**å¼‚æ­¥å’Œå•çº¿ç¨‹**ï¼‰å…¶ä¸­çš„ä¸€åº§å±±ã€‚

å¾ˆå¤šé«˜çº§åº”ç”¨éƒ½éœ€è¦ä¾é é—­åŒ…æ¥å®éªŒï¼ŒåŒ…æ‹¬æˆ‘ä»¬å»çœ‹å¾ˆå¤šçš„ `JS` åº“å’Œæ¡†æ¶çš„æºç ï¼Œéƒ½å°‘ä¸äº†é—­åŒ…çš„å½±å­ã€‚

## å®šä¹‰

### **é—­åŒ…å°±æ˜¯èƒ½å¤Ÿè¯»å–å…¶å®ƒå‡½æ•°å†…éƒ¨å˜é‡çš„å‡½æ•°ã€‚**

ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å€ŸåŠ©é—­åŒ…æ¥ **è¯»å–å…¶å®ƒå‡½æ•°å†…éƒ¨çš„å˜é‡** å‘¢ï¼Ÿ

å› ä¸º `JavaScript` è¿™ä¸ªè¯­è¨€çš„ç‰¹åˆ«ä¹‹å¤„å°±åœ¨äºï¼Œ**å‡½æ•°å†…éƒ¨** å¯ä»¥ç›´æ¥è¯»å– **å…¨å±€å˜é‡** ï¼Œä½†æ˜¯åœ¨ **å‡½æ•°å¤–éƒ¨** æ— æ³•ç›´æ¥è¯»å– **å‡½æ•°å†…éƒ¨** çš„ **å±€éƒ¨å˜é‡** ã€‚åªæœ‰ **å‡½æ•°å†…éƒ¨** çš„ **å­å‡½æ•°** æ‰èƒ½è¯»å– **å±€éƒ¨å˜é‡** ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚

```js
// æ­¤éƒ¨åˆ†åªä¸ºæ¼”ç¤ºå…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ ä¸é—­åŒ…æ— å…³
// å…¨å±€å˜é‡ åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¿é—®
let s = 100;
function foo() {
  // å±€éƒ¨å˜é‡,å‡½æ•°è¿è¡Œæ—¶åˆ›å»º,å‡½æ•°æ‰§è¡Œå®Œé”€æ¯
  let a = 10;
  function boo() {
    console.log("ğŸš€ğŸš€~ boo:", a); //ğŸš€ğŸš€~ boo: 10
  }
  boo();
}
foo();
console.log("ğŸš€ğŸš€~ s:", s); //ğŸš€ğŸš€~ s: 100
console.log("ğŸš€ğŸš€~ a:", a); // Uncaught ReferenceError: a is not defined
å¤åˆ¶ä»£ç ;
```

æ‰€ä»¥è¯´ï¼Œé—­åŒ…å¯ä»¥ç®€å•ç†è§£æˆ **å®šä¹‰åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å‡½æ•°** ã€‚é—­åŒ…æœ¬è´¨ä¸Šï¼Œå°±æ˜¯å°† **å‡½æ•°å†…éƒ¨** å’Œ **å‡½æ•°å¤–éƒ¨** è¿æ¥èµ·æ¥çš„æ¡¥æ¢ã€‚

## å¦‚ä½•ä»å¤–éƒ¨è¯»å–å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡

å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ã€‚å¦‚ä½•ä» **å‡½æ•°å¤–éƒ¨** è¯»å– **å‡½æ•°å†…éƒ¨** çš„ **å±€éƒ¨å˜é‡** ï¼Ÿå¯æ˜¯å‰é¢ä¸æ˜¯å·²ç»è¯´äº†ä¹ˆï¼Œåœ¨ **å‡½æ•°å¤–éƒ¨** æ— æ³•ç›´æ¥è¯»å– **å‡½æ•°å†…éƒ¨** çš„ **å±€éƒ¨å˜é‡** ã€‚

æ˜¯çš„ï¼Œç¡®å®æ— æ³• **ç›´æ¥** è¯»å–ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ **å˜é€š** ä¸€ä¸‹ã€‚

ç¬¬ä¸€ç§æ˜¯ `return` è¿”å›ã€‚

```js
function foo() {
  let a = 88;
  return a;
}
console.log("ğŸš€ğŸš€~ : a", foo()); // ğŸš€ğŸš€~ : a 88

å¤åˆ¶ä»£ç ;
```

ç¬¬äºŒç§æ˜¯ä¸Šé¢æåˆ°çš„å­å‡½æ•°ã€‚

```js
function foo() {
  let a = 99;
  function boo() {
    console.log("ğŸš€ğŸš€~ a:", a);
  }
  boo();
}
foo(); // ğŸš€ğŸš€~ a: 99
å¤åˆ¶ä»£ç ;
```

è¿™é‡Œå…ˆç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜ã€‚

- æ ¹æ®é—­åŒ…çš„å®šä¹‰ï¼Œé—­åŒ…å°±æ˜¯èƒ½å¤Ÿè¯»å–å…¶å®ƒå‡½æ•°å†…éƒ¨å˜é‡çš„å‡½æ•°ï¼Œé‚£ä¹ˆä»¥ä¸Šä¸¤ç§æ–¹å¼æ˜¯é—­åŒ…ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œä»–ä»¬éƒ½èƒ½æ‹¿åˆ°å±€éƒ¨å˜é‡çš„å€¼ï¼Œå¹¶ä¸”æ›´ç®€å•ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨é—­åŒ…å‘¢ï¼Ÿ

## ä¸ºä»€ä¹ˆéœ€è¦é—­åŒ…

å±€éƒ¨å˜é‡åœ¨å‡½æ•°æ‰§è¡Œæ—¶è¢«åˆ›å»ºï¼Œå‡½æ•°æ‰§è¡Œå®Œè¢«é”€æ¯ï¼Œæ²¡æœ‰åŠæ³• **é•¿ä¹…çš„ä¿å­˜çŠ¶æ€** å’Œ **å…±äº«** ã€‚

å…¨å±€å˜é‡å¯èƒ½é€ æˆ **å˜é‡æ±¡æŸ“** ï¼Œä½¿ä»£ç å˜å¾—éš¾ä»¥é˜…è¯»ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚

é‚£ä¹ˆæˆ‘ä»¬å°±å¸Œæœ›æœ‰ä¸€ç§ **å³å¯ä»¥é•¿ä¹…çš„ä¿å­˜å˜é‡**ï¼Œ**åˆä¸ä¼šé€ æˆå…¨å±€æ±¡æŸ“** çš„æ“ä½œï¼Œé—­åŒ…ä¹Ÿå°±åº”è¿è€Œç”Ÿäº†ã€‚

## é—­åŒ…çš„å†™æ³•

```js
function f1() {
  let a = 10;
  function f2() {
    a++;
    console.log("ğŸš€ğŸš€~ a:", a);
  }
  return f2;
}
let fn = f1(); // f1æ‰§è¡Œçš„ç»“æœå°±æ˜¯é—­åŒ…
fn();
å¤åˆ¶ä»£ç ;
```

## æ€è€ƒé¢˜è§£ç­”

ç°åœ¨æˆ‘ä»¬å°±æ¥è§£ç­”ä¸€ä¸‹åˆšæ‰ç•™ä¸‹çš„æ€è€ƒé¢˜ï¼Œ`å­å‡½æ•°` å’Œç›´æ¥ `return` ä¹Ÿèƒ½æ‹¿åˆ°å±€éƒ¨å˜é‡çš„å€¼ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦é—­åŒ…å‘¢ã€‚

```js
//é—­åŒ…
function f1() {
  let a = 10;
  function f2() {
    a++;
    console.log("ğŸš€ğŸš€~ a:", a);
  }
  return f2;
}
let fn = f1();
fn();

//ç›´æ¥return
function f3() {
  var a = 10;
  a++;
  return a;
}
console.log("ğŸš€ğŸš€~ a:", f3());

//å­å‡½æ•°
function f4() {
  let a = 10;
  function f5() {
    a++;
    console.log("ğŸš€ğŸš€~ a:", a);
  }
  f5();
}
f4();
å¤åˆ¶ä»£ç ;
```

å¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9b4fc7f083644e781e8098ca25b9049~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

é‚£ä¹ˆæˆ‘ä»¬å¤šè°ƒç”¨å‡ æ¬¡å‘¢ï¼Ÿ

```js
//é—­åŒ…
function f1() {
  let a = 10;
  function f2() {
    a++;
    console.log("ğŸš€ğŸš€~ é—­åŒ… ~ a:", a);
  }
  return f2;
}
let fn = f1(); // f1æ‰§è¡Œçš„ç»“æœå°±æ˜¯é—­åŒ…
fn();
fn();
fn();
fn();

//return
function f3() {
  let a = 10;
  a++;
  console.log("ğŸš€ğŸš€~ return a:", a);
}
f3();
f3();
f3();
f3();

//å­å‡½æ•°
function f4() {
  let a = 10;
  function f5() {
    a++;
    console.log("ğŸš€ğŸš€~ å­å‡½æ•° a:", a);
  }
  f5();
}
f4();
f4();
f4();
f4();
å¤åˆ¶ä»£ç ;
```

å‘ç°ä»€ä¹ˆäº†ä¹ˆï¼Œæˆ‘ä»¬ä½¿ç”¨é—­åŒ…ï¼Œæ¯æ¬¡è°ƒç”¨åï¼Œå˜é‡ `a` çš„å€¼éƒ½ä¼š `+1` ï¼Œè€Œæˆ‘ä»¬ç›´æ¥ `return` ä»¥åŠ `å­å‡½æ•°` çš„æ–¹å¼ï¼Œæ¯æ¬¡è°ƒç”¨åï¼Œå˜é‡ `a` çš„å€¼ä¸€ç›´éƒ½æ˜¯ `11` ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/515a78671d384bb6b1ab648959d7019e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

åˆ°è¿™é‡Œä¹‹å‰ç•™ä¸‹çš„æ€è€ƒé¢˜å°±å·²ç»æœ‰ç­”æ¡ˆäº†ã€‚é—­åŒ…æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè¯»å–å…¶å®ƒå‡½æ•°å†…éƒ¨å˜é‡çš„å‡½æ•°ï¼Œä½†æ˜¯èƒ½å¤Ÿè¯»å–å…¶å®ƒå‡½æ•°å†…éƒ¨å˜é‡çš„å‡½æ•°ä¸ä¸€å®šå°±æ˜¯é—­åŒ…ï¼Œä¸ºä»€ä¹ˆéœ€è¦é—­åŒ…ï¼Œå› ä¸ºé—­åŒ… **å³å¯ä»¥é•¿ä¹…çš„ä¿å­˜å˜é‡**ï¼Œ**åˆä¸ä¼šé€ æˆå…¨å±€æ±¡æŸ“**ã€‚

## é—­åŒ…çš„ç¼ºç‚¹

ä¼˜ç‚¹ä¸Šé¢å·²ç»è¯´è¿‡äº†ï¼Œé‚£ä¹ˆé—­åŒ…æœ‰ä»€ä¹ˆç¼ºç‚¹å‘¢ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå‡½æ•°çš„æ´»åŠ¨å¯¹è±¡ä¼šéšç€æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸€èµ·è¢«é”€æ¯ï¼Œä½†æ˜¯ç”±äºé—­åŒ…å¼•ç”¨çš„æ˜¯å¤–éƒ¨å‡½æ•°çš„æ´»åŠ¨å¯¹è±¡ï¼Œå› æ­¤è¿™ä¸ªæ´»åŠ¨å¯¹è±¡æ— æ³•è¢«é”€æ¯ï¼Œè¿™æ„å‘³ç€é—­åŒ…æ¯”æ™®é€šå‡½æ•°è¦æ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚

## æ¡ˆä¾‹-ç¼“å­˜

```js
const cacheMemory = (() => {
  let cache = {};
  return {
    set: (id) => {
      if (id in cache) {
        return `æŸ¥æ‰¾åˆ°çš„ç»“æœæ˜¯${cache[id]}`;
      }
      const result = asyncFn(id); //æ¨¡æ‹Ÿå¼‚æ­¥ç»“æœ
      cache[id] = result;
      return `æŸ¥æ‰¾åˆ°çš„ç»“æœæ˜¯${cache[id]}`;
    },
  };
})();
å¤åˆ¶ä»£ç ;
```

## æ¡ˆä¾‹-æ¨¡æ‹Ÿæ ˆ

```js
const Stack = (() => {
  let arr = [];
  return {
    push: (value) => {
      arr.push(value);
    },
    pop: (value) => arr.pop(value),
    size: () => arr.length,
  };
})();

Stack.push("a");
Stack.push("b");
console.log("ğŸš€ğŸš€~ Stack.size:", Stack.size()); // 2
console.log('ğŸš€ğŸš€~ Stack.pop("b"):', Stack.pop("b")); // b
console.log("ğŸš€ğŸš€~ Stack.size:", Stack.size()); // 1
å¤åˆ¶ä»£ç ;
```

## ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–ï¼ˆ curryï¼‰

åœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†ä½¿ç”¨å¤šä¸ªå‚æ•°çš„ä¸€ä¸ªå‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ä¸ªæ¥æ”¶ 3 ä¸ªå‚æ•°çš„æ™®é€šå‡½æ•°ï¼Œåœ¨è¿›è¡ŒæŸ¯é‡ŒåŒ–åï¼Œ æŸ¯é‡ŒåŒ–ç‰ˆæœ¬çš„å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°å¹¶è¿”å›æ¥æ”¶ä¸‹ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œ è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ æœ€åä¸€ä¸ªå‡½æ•°åœ¨æ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°åï¼Œ å°†ä¹‹å‰æ¥æ”¶åˆ°çš„ä¸‰ä¸ªå‚æ•°åº”ç”¨äºåŸæ™®é€šå‡½æ•°ä¸­ï¼Œå¹¶è¿”å›æœ€ç»ˆç»“æœã€‚

```
// æ•°å­¦å’Œè®¡ç®—ç§‘å­¦ä¸­çš„æŸ¯é‡ŒåŒ–ï¼š

//ä¸€ä¸ªæ¥æ”¶ä¸‰ä¸ªå‚æ•°çš„æ™®é€šå‡½æ•°
function sum(a,b,c) {
    console.log(a+b+c)
}

//ç”¨äºå°†æ™®é€šå‡½æ•°è½¬åŒ–ä¸ºæŸ¯é‡ŒåŒ–ç‰ˆæœ¬çš„å·¥å…·å‡½æ•°
function curry(fn) {
  //...å†…éƒ¨å®ç°çœç•¥ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°
}

//è·å–ä¸€ä¸ªæŸ¯é‡ŒåŒ–åçš„å‡½æ•°
let _sum = curry(sum);

//è¿”å›ä¸€ä¸ªæ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°çš„å‡½æ•°
let A = _sum(1);
//è¿”å›ä¸€ä¸ªæ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°çš„å‡½æ•°
let B = A(2);
//æ¥æ”¶åˆ°æœ€åä¸€ä¸ªå‚æ•°ï¼Œå°†ä¹‹å‰æ‰€æœ‰çš„å‚æ•°åº”ç”¨åˆ°åŸå‡½æ•°ä¸­ï¼Œå¹¶è¿è¡Œ
B(3)    // print : 6
å¤åˆ¶ä»£ç 
```

è€Œå¯¹äº Javascript è¯­è¨€æ¥è¯´ï¼Œæˆ‘ä»¬é€šå¸¸è¯´çš„æŸ¯é‡ŒåŒ–å‡½æ•°çš„æ¦‚å¿µï¼Œä¸æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­çš„æŸ¯é‡ŒåŒ–çš„æ¦‚å¿µå¹¶ä¸å®Œå…¨ä¸€æ ·ã€‚

åœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­çš„æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œä¸€æ¬¡åªèƒ½ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼›

è€Œæˆ‘ä»¬ Javascript å®é™…åº”ç”¨ä¸­çš„æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚

æ¥çœ‹è¿™ä¸ªä¾‹å­ï¼š

```
//æ™®é€šå‡½æ•°
function fn(a,b,c,d,e) {
  console.log(a,b,c,d,e)
}
//ç”Ÿæˆçš„æŸ¯é‡ŒåŒ–å‡½æ•°
let _fn = curry(fn);

_fn(1,2,3,4,5);     // print: 1,2,3,4,5
_fn(1)(2)(3,4,5);   // print: 1,2,3,4,5
_fn(1,2)(3,4)(5);   // print: 1,2,3,4,5
_fn(1)(2)(3)(4)(5); // print: 1,2,3,4,5
å¤åˆ¶ä»£ç 
```

å¯¹äºå·²ç»æŸ¯é‡ŒåŒ–åçš„ \_fn å‡½æ•°æ¥è¯´ï¼Œå½“æ¥æ”¶çš„å‚æ•°æ•°é‡ä¸åŸå‡½æ•°çš„å½¢å‚æ•°é‡ç›¸åŒæ—¶ï¼Œæ‰§è¡ŒåŸå‡½æ•°ï¼› å½“æ¥æ”¶çš„å‚æ•°æ•°é‡å°äºåŸå‡½æ•°çš„å½¢å‚æ•°é‡æ—¶ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ç”¨äºæ¥æ”¶å‰©ä½™çš„å‚æ•°ï¼Œç›´è‡³æ¥æ”¶çš„å‚æ•°æ•°é‡ä¸å½¢å‚æ•°é‡ä¸€è‡´ï¼Œæ‰§è¡ŒåŸå‡½æ•°ã€‚

å½“æˆ‘ä»¬çŸ¥é“æŸ¯é‡ŒåŒ–æ˜¯ä»€ä¹ˆäº†çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æŸ¯é‡ŒåŒ–åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

## æŸ¯é‡ŒåŒ–çš„ç”¨é€”

æŸ¯é‡ŒåŒ–å®é™…æ˜¯æŠŠç®€ç­”çš„é—®é¢˜å¤æ‚åŒ–äº†ï¼Œä½†æ˜¯å¤æ‚åŒ–çš„åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å‡½æ•°æ—¶æ‹¥æœ‰äº†æ›´åŠ å¤šçš„è‡ªç”±åº¦ã€‚ è€Œè¿™é‡Œå¯¹äºå‡½æ•°å‚æ•°çš„è‡ªç”±å¤„ç†ï¼Œæ­£æ˜¯æŸ¯é‡ŒåŒ–çš„æ ¸å¿ƒæ‰€åœ¨ã€‚ **æŸ¯é‡ŒåŒ–æœ¬è´¨ä¸Šæ˜¯é™ä½é€šç”¨æ€§ï¼Œæé«˜é€‚ç”¨æ€§ã€‚**æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

æˆ‘ä»¬å·¥ä½œä¸­ä¼šé‡åˆ°å„ç§éœ€è¦é€šè¿‡æ­£åˆ™æ£€éªŒçš„éœ€æ±‚ï¼Œæ¯”å¦‚æ ¡éªŒç”µè¯å·ç ã€æ ¡éªŒé‚®ç®±ã€æ ¡éªŒèº«ä»½è¯å·ã€æ ¡éªŒå¯†ç ç­‰ï¼Œ è¿™æ—¶æˆ‘ä»¬ä¼šå°è£…ä¸€ä¸ªé€šç”¨å‡½æ•° checkByRegExp ,æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæ ¡éªŒçš„æ­£åˆ™å¯¹è±¡å’Œå¾…æ ¡éªŒçš„å­—ç¬¦ä¸²

```
function checkByRegExp(regExp,string) {
    return regExp.test(string);
}

checkByRegExp(/^1\d{10}$/, '18642838455'); // æ ¡éªŒç”µè¯å·ç 
checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@163.com'); // æ ¡éªŒé‚®ç®±
```

ä¸Šé¢è¿™æ®µä»£ç ï¼Œä¹ä¸€çœ‹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥æ»¡è¶³æˆ‘ä»¬æ‰€æœ‰é€šè¿‡æ­£åˆ™æ£€éªŒçš„éœ€æ±‚ã€‚ ä½†æ˜¯æˆ‘ä»¬è€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ ¡éªŒå¤šä¸ªç”µè¯å·ç æˆ–è€…æ ¡éªŒå¤šä¸ªé‚®ç®±å‘¢ï¼Ÿ

æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·åšï¼š

```
checkByRegExp(/^1\d{10}$/, '18642838455'); // æ ¡éªŒç”µè¯å·ç 
checkByRegExp(/^1\d{10}$/, '13109840560'); // æ ¡éªŒç”µè¯å·ç 
checkByRegExp(/^1\d{10}$/, '13204061212'); // æ ¡éªŒç”µè¯å·ç 

checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@163.com'); // æ ¡éªŒé‚®ç®±
checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@qq.com'); // æ ¡éªŒé‚®ç®±
checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@gmail.com'); // æ ¡éªŒé‚®ç®±
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬æ¯æ¬¡è¿›è¡Œæ ¡éªŒçš„æ—¶å€™éƒ½éœ€è¦è¾“å…¥ä¸€ä¸²æ­£åˆ™ï¼Œå†æ ¡éªŒåŒä¸€ç±»å‹çš„æ•°æ®æ—¶ï¼Œç›¸åŒçš„æ­£åˆ™æˆ‘ä»¬éœ€è¦å†™å¤šæ¬¡ï¼Œ è¿™å°±å¯¼è‡´æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™æ•ˆç‡ä½ä¸‹ï¼Œå¹¶ä¸”ç”±äº checkByRegExp å‡½æ•°æœ¬èº«æ˜¯ä¸€ä¸ªå·¥å…·å‡½æ•°å¹¶æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œ ä¸€æ®µæ—¶é—´åæˆ‘ä»¬é‡æ–°æ¥çœ‹è¿™äº›ä»£ç æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ³¨é‡Šï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡æ£€æŸ¥æ­£åˆ™çš„å†…å®¹ï¼Œ æˆ‘ä»¬æ‰èƒ½çŸ¥é“æˆ‘ä»¬æ ¡éªŒçš„æ˜¯ç”µè¯å·ç è¿˜æ˜¯é‚®ç®±ï¼Œè¿˜æ˜¯åˆ«çš„ä»€ä¹ˆã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©æŸ¯é‡ŒåŒ–å¯¹ checkByRegExp å‡½æ•°è¿›è¡Œå°è£…ï¼Œä»¥ç®€åŒ–ä»£ç ä¹¦å†™ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚

```
//è¿›è¡ŒæŸ¯é‡ŒåŒ–
let _check = curry(checkByRegExp);
//ç”Ÿæˆå·¥å…·å‡½æ•°ï¼ŒéªŒè¯ç”µè¯å·ç 
let checkCellPhone = _check(/^1\d{10}$/);
//ç”Ÿæˆå·¥å…·å‡½æ•°ï¼ŒéªŒè¯é‚®ç®±
let checkEmail = _check(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/);

checkCellPhone('18642838455'); // æ ¡éªŒç”µè¯å·ç 
checkCellPhone('13109840560'); // æ ¡éªŒç”µè¯å·ç 
checkCellPhone('13204061212'); // æ ¡éªŒç”µè¯å·ç 

checkEmail('test@163.com'); // æ ¡éªŒé‚®ç®±
checkEmail('test@qq.com'); // æ ¡éªŒé‚®ç®±
checkEmail('test@gmail.com'); // æ ¡éªŒé‚®ç®±
å¤åˆ¶ä»£ç 
```

å†æ¥çœ‹çœ‹é€šè¿‡æŸ¯é‡ŒåŒ–å°è£…åï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯ä¸æ˜¯å˜å¾—åˆç®€æ´åˆç›´è§‚äº†å‘¢ã€‚

ç»è¿‡æŸ¯é‡ŒåŒ–åï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸¤ä¸ªå‡½æ•° checkCellPhone å’Œ checkEmailï¼Œ checkCellPhone å‡½æ•°åªèƒ½éªŒè¯ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ç”µè¯å·ç ï¼Œ checkEmail å‡½æ•°åªèƒ½éªŒè¯ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯é‚®ç®±ï¼Œ å®ƒä»¬ä¸ åŸå‡½æ•° checkByRegExp ç›¸æ¯”ï¼Œä»åŠŸèƒ½ä¸Šé€šç”¨æ€§é™ä½äº†ï¼Œä½†é€‚ç”¨æ€§æå‡äº†ã€‚ æŸ¯é‡ŒåŒ–çš„è¿™ç§ç”¨é€”å¯ä»¥è¢«ç†è§£ä¸ºï¼š**å‚æ•°å¤ç”¨**

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­

å‡å®šæˆ‘ä»¬æœ‰è¿™æ ·ä¸€æ®µæ•°æ®ï¼š

```
let list = [
    {
        name:'lucy'
    },
    {
        name:'jack'
    }
]
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬éœ€è¦è·å–æ•°æ®ä¸­çš„æ‰€æœ‰ name å±æ€§çš„å€¼ï¼Œå¸¸è§„æ€è·¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šè¿™æ ·å®ç°:

```
let names = list.map(function(item) {
  return item.name;
})
å¤åˆ¶ä»£ç 
```

é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ç”¨æŸ¯é‡ŒåŒ–çš„æ€ç»´æ¥å®ç°å‘¢

```
let prop = curry(function(key,obj) {
    return obj[key];
})
let names = list.map(prop('name'))
å¤åˆ¶ä»£ç 
```

çœ‹åˆ°è¿™é‡Œï¼Œå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œè¿™ä¹ˆç®€å•çš„ä¾‹å­ï¼Œä»…ä»…åªæ˜¯ä¸ºäº†è·å– name çš„å±æ€§å€¼ï¼Œä¸ºä½•è¿˜è¦å®ç°ä¸€ä¸ª prop å‡½æ•°å‘¢ï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†å§ã€‚

æˆ‘ä»¬å¯ä»¥æ¢ä¸ªæ€è·¯ï¼Œprop å‡½æ•°å®ç°ä¸€æ¬¡åï¼Œä»¥åæ˜¯å¯ä»¥å¤šæ¬¡ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è€ƒè™‘ä»£ç å¤æ‚ç¨‹åº¦çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥å°† prop å‡½æ•°çš„å®ç°å»æ‰çš„ã€‚

æˆ‘ä»¬å®é™…çš„ä»£ç å¯ä»¥ç†è§£ä¸ºåªæœ‰ä¸€è¡Œ let names = list.map(prop('name'))

è¿™ä¹ˆçœ‹æ¥ï¼Œé€šè¿‡æŸ¯é‡ŒåŒ–çš„æ–¹å¼ï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯ä¸æ˜¯å˜å¾—æ›´ç²¾ç®€äº†ï¼Œå¹¶ä¸”å¯è¯»æ€§æ›´é«˜äº†å‘¢ã€‚

## å¦‚ä½•å°è£…æŸ¯é‡ŒåŒ–å·¥å…·å‡½æ•°

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ€è€ƒå¦‚ä½•å®ç° curry å‡½æ•°ã€‚

å›æƒ³ä¹‹å‰æˆ‘ä»¬å¯¹äºæŸ¯é‡ŒåŒ–çš„å®šä¹‰ï¼Œ**æ¥æ”¶ä¸€éƒ¨åˆ†å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°æ¥æ”¶å‰©ä½™å‚æ•°ï¼Œæ¥æ”¶è¶³å¤Ÿå‚æ•°åï¼Œæ‰§è¡ŒåŸå‡½æ•°ã€‚**

æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œå½“æŸ¯é‡ŒåŒ–å‡½æ•°æ¥æ”¶åˆ°è¶³å¤Ÿå‚æ•°åï¼Œå°±ä¼šæ‰§è¡ŒåŸå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å»ç¡®å®šä½•æ—¶è¾¾åˆ°è¶³å¤Ÿçš„å‚æ•°å‘¢ï¼Ÿ

æˆ‘ä»¬æœ‰ä¸¤ç§æ€è·¯ï¼š

1. é€šè¿‡å‡½æ•°çš„ length å±æ€§ï¼Œè·å–å‡½æ•°çš„å½¢å‚ä¸ªæ•°ï¼Œå½¢å‚çš„ä¸ªæ•°å°±æ˜¯æ‰€éœ€çš„å‚æ•°ä¸ªæ•°
2. åœ¨è°ƒç”¨æŸ¯é‡ŒåŒ–å·¥å…·å‡½æ•°æ—¶ï¼Œæ‰‹åŠ¨æŒ‡å®šæ‰€éœ€çš„å‚æ•°ä¸ªæ•°

æˆ‘ä»¬å°†è¿™ä¸¤ç‚¹ç»“åˆä»¥ä¸‹ï¼Œå®ç°ä¸€ä¸ªç®€å• curry å‡½æ•°ï¼š

```
/**
 * å°†å‡½æ•°æŸ¯é‡ŒåŒ–
 * @param fn    å¾…æŸ¯é‡ŒåŒ–çš„åŸå‡½æ•°
 * @param len   æ‰€éœ€çš„å‚æ•°ä¸ªæ•°ï¼Œé»˜è®¤ä¸ºåŸå‡½æ•°çš„å½¢å‚ä¸ªæ•°
 */
function curry(fn,len = fn.length) {
    return _curry.call(this,fn,len)
}

/**
 * ä¸­è½¬å‡½æ•°
 * @param fn    å¾…æŸ¯é‡ŒåŒ–çš„åŸå‡½æ•°
 * @param len   æ‰€éœ€çš„å‚æ•°ä¸ªæ•°
 * @param args  å·²æ¥æ”¶çš„å‚æ•°åˆ—è¡¨
 */
function _curry(fn,len,...args) {
    return function (...params) {
        let _args = [...args,...params];
        if(_args.length >= len){
            return fn.apply(this,_args);
        }else{
            return _curry.call(this,fn,len,..._args)
        }
    }
}
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š

```
let _fn = curry(function(a,b,c,d,e){
    console.log(a,b,c,d,e)
});

_fn(1,2,3,4,5);     // print: 1,2,3,4,5
_fn(1)(2)(3,4,5);   // print: 1,2,3,4,5
_fn(1,2)(3,4)(5);   // print: 1,2,3,4,5
_fn(1)(2)(3)(4)(5); // print: 1,2,3,4,5
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬å¸¸ç”¨çš„å·¥å…·åº“ lodash ä¹Ÿæä¾›äº† curry æ–¹æ³•ï¼Œå¹¶ä¸”å¢åŠ äº†éå¸¸å¥½ç©çš„ placeholder åŠŸèƒ½ï¼Œé€šè¿‡å ä½ç¬¦çš„æ–¹å¼æ¥æ”¹å˜ä¼ å…¥å‚æ•°çš„é¡ºåºã€‚

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªå ä½ç¬¦ï¼Œæœ¬æ¬¡è°ƒç”¨ä¼ é€’çš„å‚æ•°ç•¥è¿‡å ä½ç¬¦ï¼Œ å ä½ç¬¦æ‰€åœ¨çš„ä½ç½®ç”±ä¸‹æ¬¡è°ƒç”¨çš„å‚æ•°æ¥å¡«å……ï¼Œæ¯”å¦‚è¿™æ ·ï¼š

ç›´æ¥çœ‹ä¸€ä¸‹å®˜ç½‘çš„ä¾‹å­ï¼š

![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/8/16bcf2a1a520ad3a~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp)

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ€è€ƒï¼Œå¦‚ä½•å®ç°å ä½ç¬¦çš„åŠŸèƒ½ã€‚

å¯¹äº lodash çš„ curry å‡½æ•°æ¥è¯´ï¼Œcurry å‡½æ•°æŒ‚è½½åœ¨ lodash å¯¹è±¡ä¸Šï¼Œæ‰€ä»¥å°† lodash å¯¹è±¡å½“åšé»˜è®¤å ä½ç¬¦æ¥ä½¿ç”¨ã€‚

è€Œæˆ‘ä»¬çš„è‡ªå·±å®ç°çš„ curry å‡½æ•°ï¼Œæœ¬èº«å¹¶æ²¡æœ‰æŒ‚è½½åœ¨ä»»ä½•å¯¹è±¡ä¸Šï¼Œæ‰€ä»¥å°† curry å‡½æ•°å½“åšé»˜è®¤å ä½ç¬¦

ä½¿ç”¨å ä½ç¬¦ï¼Œç›®çš„æ˜¯æ”¹å˜å‚æ•°ä¼ é€’çš„é¡ºåºï¼Œæ‰€ä»¥åœ¨ curry å‡½æ•°å®ç°ä¸­ï¼Œæ¯æ¬¡éœ€è¦è®°å½•æ˜¯å¦ä½¿ç”¨äº†å ä½ç¬¦ï¼Œå¹¶ä¸”è®°å½•å ä½ç¬¦æ‰€ä»£è¡¨çš„å‚æ•°ä½ç½®ã€‚

ç›´æ¥ä¸Šä»£ç ï¼š

```
/**
 * @param  fn           å¾…æŸ¯é‡ŒåŒ–çš„å‡½æ•°
 * @param  length       éœ€è¦çš„å‚æ•°ä¸ªæ•°ï¼Œé»˜è®¤ä¸ºå‡½æ•°çš„å½¢å‚ä¸ªæ•°
 * @param  holder       å ä½ç¬¦ï¼Œé»˜è®¤å½“å‰æŸ¯é‡ŒåŒ–å‡½æ•°
 * @return {Function}   æŸ¯é‡ŒåŒ–åçš„å‡½æ•°
 */
function curry(fn,length = fn.length,holder = curry){
    return _curry.call(this,fn,length,holder,[],[])
}
/**
 * ä¸­è½¬å‡½æ•°
 * @param fn            æŸ¯é‡ŒåŒ–çš„åŸå‡½æ•°
 * @param length        åŸå‡½æ•°éœ€è¦çš„å‚æ•°ä¸ªæ•°
 * @param holder        æ¥æ”¶çš„å ä½ç¬¦
 * @param args          å·²æ¥æ”¶çš„å‚æ•°åˆ—è¡¨
 * @param holders       å·²æ¥æ”¶çš„å ä½ç¬¦ä½ç½®åˆ—è¡¨
 * @return {Function}   ç»§ç»­æŸ¯é‡ŒåŒ–çš„å‡½æ•° æˆ– æœ€ç»ˆç»“æœ
 */
function _curry(fn,length,holder,args,holders){
    return function(..._args){
        //å°†å‚æ•°å¤åˆ¶ä¸€ä»½ï¼Œé¿å…å¤šæ¬¡æ“ä½œåŒä¸€å‡½æ•°å¯¼è‡´å‚æ•°æ··ä¹±
        let params = args.slice();
        //å°†å ä½ç¬¦ä½ç½®åˆ—è¡¨å¤åˆ¶ä¸€ä»½ï¼Œæ–°å¢åŠ çš„å ä½ç¬¦å¢åŠ è‡³æ­¤
        let _holders = holders.slice();
        //å¾ªç¯å…¥å‚ï¼Œè¿½åŠ å‚æ•° æˆ– æ›¿æ¢å ä½ç¬¦
        _args.forEach((arg,i)=>{
            //çœŸå®å‚æ•° ä¹‹å‰å­˜åœ¨å ä½ç¬¦ å°†å ä½ç¬¦æ›¿æ¢ä¸ºçœŸå®å‚æ•°
            if (arg !== holder && holders.length) {
                let index = holders.shift();
                _holders.splice(_holders.indexOf(index),1);
                params[index] = arg;
            }
            //çœŸå®å‚æ•° ä¹‹å‰ä¸å­˜åœ¨å ä½ç¬¦ å°†å‚æ•°è¿½åŠ åˆ°å‚æ•°åˆ—è¡¨ä¸­
            else if(arg !== holder && !holders.length){
                params.push(arg);
            }
            //ä¼ å…¥çš„æ˜¯å ä½ç¬¦,ä¹‹å‰ä¸å­˜åœ¨å ä½ç¬¦ è®°å½•å ä½ç¬¦çš„ä½ç½®
            else if(arg === holder && !holders.length){
                params.push(arg);
                _holders.push(params.length - 1);
            }
            //ä¼ å…¥çš„æ˜¯å ä½ç¬¦,ä¹‹å‰å­˜åœ¨å ä½ç¬¦ åˆ é™¤åŸå ä½ç¬¦ä½ç½®
            else if(arg === holder && holders.length){
                holders.shift();
            }
        });
        // params ä¸­å‰ length æ¡è®°å½•ä¸­ä¸åŒ…å«å ä½ç¬¦ï¼Œæ‰§è¡Œå‡½æ•°
        if(params.length >= length && params.slice(0,length).every(i=>i!==holder)){
            return fn.apply(this,params);
        }else{
            return _curry.call(this,fn,length,holder,params,_holders)
        }
    }
}

å¤åˆ¶ä»£ç 
```

éªŒè¯ä¸€ä¸‹ï¼šï¼›

```
let fn = function(a, b, c, d, e) {
    console.log([a, b, c, d, e]);
}

let _ = {}; // å®šä¹‰å ä½ç¬¦
let _fn = curry(fn,5,_);  // å°†å‡½æ•°æŸ¯é‡ŒåŒ–ï¼ŒæŒ‡å®šæ‰€éœ€çš„å‚æ•°ä¸ªæ•°ï¼ŒæŒ‡å®šæ‰€éœ€çš„å ä½ç¬¦

_fn(1, 2, 3, 4, 5);                 // print: 1,2,3,4,5
_fn(_, 2, 3, 4, 5)(1);              // print: 1,2,3,4,5
_fn(1, _, 3, 4, 5)(2);              // print: 1,2,3,4,5
_fn(1, _, 3)(_, 4,_)(2)(5);         // print: 1,2,3,4,5
_fn(1, _, _, 4)(_, 3)(2)(5);        // print: 1,2,3,4,5
_fn(_, 2)(_, _, 4)(1)(3)(5);        // print: 1,2,3,4,5
å¤åˆ¶ä»£ç 
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæ•´å®ç°äº†ä¸€ä¸ª curry å‡½æ•°~~

## ç³»åˆ—æ–‡ç« æ¨è

- [ã€Œå‰ç«¯è¿›é˜¶ã€å•é¡µè·¯ç”±è§£æä¸å®ç°](https://juejin.cn/post/6844903890278694919)
- [ã€Œå‰ç«¯è¿›é˜¶ã€JS ä¸­çš„æ ˆå†…å­˜å †å†…å­˜](https://juejin.cn/post/6844903873992196110)
- [ã€Œå‰ç«¯è¿›é˜¶ã€JS ä¸­çš„å†…å­˜ç®¡ç†](https://juejin.cn/post/6844903869525262349)
- [ã€Œå‰ç«¯è¿›é˜¶ã€æ•°ç»„ä¹±åº](https://juejin.cn/post/6844903863812620296)

##
