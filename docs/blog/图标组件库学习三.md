---
create_time: 2024-08-24 00:09:54
---

# 图标组件库学习

> 使用 AI 工具 MarsCode 学习开源代码，本文档学习图标组件库的设计和实现。

::: tip
图标组件库打包可以同时生成多个版本的组件库，比如 React、Vue、Flutter 等。生成 esm、cjs、umd 等多个版本。

IconPark：https://github.com/bytedance/IconPark

IconSpace：https://github.com/icon-space/IconSpace

iconoir：https://github.com/iconoir-icons/iconoir

IconSpace 本项目是由 IconPark 派生而来，在此基础上进行改造和扩充。
:::

## gulp 打包

```shell
"build:source": "gulp",
```

[gulp](https://gulpjs.com/) 用自动化构建工具增强你的工作流程。[gulp 中文网站](https://www.gulpjs.com.cn/)

### gulpfile.ts

```ts
/**
 * @file gulpfile 编译文件
 */

import path from "path";
import gulp from "gulp";
import babel from "gulp-babel";
import ts from "gulp-typescript";
import merge from "merge2";
import less from "gulp-less";
import minifyCss from "gulp-minify-css";
import rename from "gulp-rename";
import replace from "gulp-replace";
import configVue from "./packages/vue/tsconfig.json";
import configVueNext from "./packages/vue-next/tsconfig.json";
import configSVG from "./packages/svg/tsconfig.json";
import configReact from "./packages/react/tsconfig.json";

const TS_CONFIG_MAP = {
  react: configReact,
  vue: configVue,
  svg: configSVG,
  "vue-next": configVueNext,
};

const BABEL_CONFIG_MAP = {
  react: {
    presets: [
      [
        "@babel/preset-env",
        {
          modules: false,
          targets: {
            browsers: ["> 1%", "last 2 versions", "not ie <= 8"],
          },
        },
      ],
      "@babel/preset-react",
    ],
    plugins: [
      [
        "@babel/plugin-proposal-class-properties",
        {
          loose: false,
        },
      ],
    ],
  },
  vue: {
    presets: [
      [
        "@babel/preset-env",
        {
          modules: false,
          targets: {
            browsers: ["> 1%", "last 2 versions", "not ie <= 8"],
          },
        },
      ],
      "@vue/babel-preset-jsx",
    ],
    plugins: [
      [
        "@babel/plugin-proposal-class-properties",
        {
          loose: false,
        },
      ],
    ],
  },
  "vue-next": {
    presets: [
      [
        "@babel/preset-env",
        {
          modules: false,
          targets: {
            browsers: ["> 1%", "last 2 versions", "not ie <= 8"],
          },
        },
      ],
    ],
    plugins: [
      [
        "@babel/plugin-proposal-class-properties",
        {
          loose: false,
        },
      ],
      "@vue/babel-plugin-jsx",
    ],
  },
  svg: {
    presets: [
      [
        "@babel/preset-env",
        {
          modules: false,
          targets: {
            browsers: ["> 1%", "last 2 versions", "not ie <= 8"],
          },
        },
      ],
    ],
    plugins: [
      [
        "@babel/plugin-proposal-class-properties",
        {
          loose: false,
        },
      ],
    ],
  },
};

function resolve(...arg: string[]): string {
  return path.resolve(process.cwd(), ...arg);
}

// 打包执行的函数
function createBuildTask(name: "react" | "vue" | "svg" | "vue-next"): string {
  const cwd = resolve("packages/", name);
  // build-script-vue-next
  gulp.task("build-script-" + name, () => {
    // src 创建一个流，用于从文件系统读取 Vinyl 对象（描述文件的元数据对象）。
    // ts（gulp-typescript）是一个用于处理TypeScript编译工作流程的Gulp插件
    const result = gulp
      .src(["src/*.ts", "src/*.tsx", "src/**/*.ts", "src/**/*.tsx"], {
        cwd,
      })
      .pipe(ts(TS_CONFIG_MAP[name].compilerOptions));
    /**
     * sinc vue@3.x is installed under alias: 'alias-for-vue3', we need to
     * replace it back to 'vue' in the compiled colde & type description before publish
     */
    const isVueNext = name === "vue-next";
    let jsResultStream = isVueNext ? result.js.pipe(replace("alias-for-vue3", "vue")) : result.js;
    let dtsResultStream = isVueNext
      ? result.dts.pipe(replace("alias-for-vue3", "vue"))
      : result.dts;
    // merge 按顺序或并行将多个流合并为一个流。
    return merge([
      jsResultStream
        .pipe(babel(BABEL_CONFIG_MAP[name]))
        .pipe(gulp.dest(cwd + "/es"))
        .pipe(
          babel({
            plugins: ["@babel/plugin-transform-modules-commonjs"],
          })
        )
        .pipe(gulp.dest(cwd + "/lib")),
      dtsResultStream.pipe(gulp.dest(cwd + "/es")).pipe(gulp.dest(cwd + "/lib")),
    ]);
  });

  gulp.task("build-copy-icons-json-" + name, () => {
    return gulp
      .src(resolve("source/icons-config.json"))
      .pipe(rename("icons.json"))
      .pipe(gulp.dest(cwd));
  });

  const tasks = ["build-script-" + name, "build-copy-icons-json-" + name];

  if (name !== "svg") {
    gulp.task("build-css-" + name, () => {
      return gulp
        .src("src/runtime/index.less", { cwd })
        .pipe(less())
        .pipe(minifyCss())
        .pipe(gulp.dest(cwd + "/styles"));
    });

    gulp.task("build-less-" + name, () => {
      return gulp.src("src/runtime/index.less", { cwd }).pipe(gulp.dest(cwd + "/styles"));
    });

    tasks.push("build-css-" + name, "build-less-" + name);
  }

  gulp.task("build-" + name, gulp.parallel(tasks));

  return "build-" + name;
}

// 并发来运行的任务
// 这个API不再是推荐的模式了
gulp.task(
  "default",
  gulp.parallel(
    createBuildTask("react"),
    createBuildTask("vue"),
    createBuildTask("vue-next"),
    createBuildTask("svg")
  )
);
```

## publish

[Lerna](https://lerna.js.org/) 是一种快速、现代的构建系统，用于从同一存储库管理和发布多个 JavaScript/TypeScript 包。

## 相关阅读

[图标组件库学习一.md](%E5%9B%BE%E6%A0%87%E7%BB%84%E4%BB%B6%E5%BA%93%E5%AD%A6%E4%B9%A0%E4%B8%80.md)
[图标组件库学习二.md](%E5%9B%BE%E6%A0%87%E7%BB%84%E4%BB%B6%E5%BA%93%E5%AD%A6%E4%B9%A0%E4%BA%8C.md)
[图标组件库学习三.md](%E5%9B%BE%E6%A0%87%E7%BB%84%E4%BB%B6%E5%BA%93%E5%AD%A6%E4%B9%A0%E4%B8%89.md)
